<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>compiler on FaultNote</title><link>https://faultnote.github.io/tags/compiler/</link><description>Recent content in compiler on FaultNote</description><generator>Hugo -- gohugo.io</generator><language>ko</language><managingEditor>soomtong@gmail.com (soomtong)</managingEditor><webMaster>soomtong@gmail.com (soomtong)</webMaster><lastBuildDate>Sat, 07 Jan 2023 20:00:00 +0900</lastBuildDate><atom:link href="https://faultnote.github.io/tags/compiler/index.xml" rel="self" type="application/rss+xml"/><item><title>Write Deadly Simple Compiler Part 3</title><link>https://faultnote.github.io/posts/write-simple-compiler-3/</link><pubDate>Sat, 07 Jan 2023 20:00:00 +0900</pubDate><author>soomtong@gmail.com (soomtong)</author><guid>https://faultnote.github.io/posts/write-simple-compiler-3/</guid><description>Phil ì˜ &amp;lsquo;Writing a lisp compiler from scratch in JavaScript&amp;rsquo; ì²« í¬ìŠ¤íŠ¸ì˜ ì„¸ ë²ˆì§¸ íŒŒíŠ¸ì¸ë° ë¶„ëŸ‰ì´ ë§ì•„ ìƒˆ í¬ìŠ¤íŠ¸ë¥¼ ì—´ì—ˆë‹¤. ì§€ë‚œ í¬ìŠ¤íŠ¸ì— ì´ì–´ì„œ&amp;hellip; Phil ì˜ ê°€ì´ë“œì— ë§ˆì§€ë§‰ ë¶€ë¶„ì€ íŒŒì‹±ëœ ë°°ì—´</description><content>&lt;blockquote>
&lt;p>&lt;a href="https://notes.eatonphil.com">Phil&lt;/a> ì˜ &amp;lsquo;Writing a lisp compiler from scratch in JavaScript&amp;rsquo; ì²« í¬ìŠ¤íŠ¸ì˜ ì„¸ ë²ˆì§¸ íŒŒíŠ¸ì¸ë° ë¶„ëŸ‰ì´ ë§ì•„ ìƒˆ í¬ìŠ¤íŠ¸ë¥¼ ì—´ì—ˆë‹¤.&lt;/p>
&lt;/blockquote>
&lt;p>ì§€ë‚œ í¬ìŠ¤íŠ¸ì— ì´ì–´ì„œ&amp;hellip;&lt;/p>
&lt;p>Phil ì˜ ê°€ì´ë“œì— ë§ˆì§€ë§‰ ë¶€ë¶„ì€ íŒŒì‹±ëœ ë°°ì—´ì„ ì–´ì…ˆë¸”ë¦¬ë¡œ ë³€í™˜í•˜ëŠ” ì»´íŒŒì¼ ê³¼ì •ì„ ë‹´ê³  ìˆë‹¤.
ê·¸ë¦¬ê³  ì–´ì…ˆë¸”ë¦¬ë¥¼ ì–´ì…ˆë¸”! í•˜ëŠ” ê²ƒìœ¼ë¡œ ì²« í¬ìŠ¤íŠ¸ë¥¼ ë§ˆì¹˜ê³  ìˆë‹¤.&lt;/p>
&lt;h2 id="í…ŒìŠ¤íŠ¸-ì½”ë“œ-ëŸ¬ë„ˆ">í…ŒìŠ¤íŠ¸ ì½”ë“œ ëŸ¬ë„ˆ&lt;/h2>
&lt;p>ì£¼ì–´ì§„ êµ¬ë¬¸ì„ íŒŒì‹±í•˜ê³  ì»´íŒŒì¼ í•˜ëŠ” ê°„ë‹¨í•œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ ë³´ì. ë³´í†µ script runner ê°™ì€ ì´ë¦„ì´ ì‚¬ìš©ëœë‹¤.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ts" data-lang="ts">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> { &lt;span style="color:#a6e22e">compile&lt;/span>, &lt;span style="color:#a6e22e">parse&lt;/span> } &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">require&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;./lib&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">program&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;(+ 3 (+ 1 2)&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> [&lt;span style="color:#a6e22e">parsed&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">parse&lt;/span>(&lt;span style="color:#a6e22e">program&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">assmbled&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">compile&lt;/span>(&lt;span style="color:#a6e22e">parsed&lt;/span>[&lt;span style="color:#ae81ff">0&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">console&lt;/span>.&lt;span style="color:#a6e22e">log&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;---------------------------------------------------&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">console&lt;/span>.&lt;span style="color:#a6e22e">dir&lt;/span>(&lt;span style="color:#a6e22e">parsed&lt;/span>, { &lt;span style="color:#a6e22e">colors&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>, &lt;span style="color:#a6e22e">depth&lt;/span>: &lt;span style="color:#66d9ef">5&lt;/span>, &lt;span style="color:#a6e22e">showHidden&lt;/span>: &lt;span style="color:#66d9ef">false&lt;/span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">console&lt;/span>.&lt;span style="color:#a6e22e">log&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;---------------------------------------------------&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">console&lt;/span>.&lt;span style="color:#a6e22e">log&lt;/span>(&lt;span style="color:#a6e22e">assmbled&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>---------------------------------------------------
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span> &lt;span style="color:#f92672">[&lt;/span> &lt;span style="color:#e6db74">&amp;#39;+&amp;#39;&lt;/span>, 3, &lt;span style="color:#f92672">[&lt;/span> &lt;span style="color:#e6db74">&amp;#39;+&amp;#39;&lt;/span>, 1, &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>---------------------------------------------------
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .global _main_
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .text
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>plus:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ADD RDI, RSI
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MOV RAX, RDI
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RET
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>_main_:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> PUSH RDI
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> PUSH RSI
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MOV RDI, &lt;span style="color:#ae81ff">3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> PUSH RDI
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> PUSH RSI
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MOV RDI, &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MOV RSI, &lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CALL plus
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> POP RSI
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> POP RDI
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MOV RSI, RAX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CALL plus
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> POP RSI
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> POP RDI
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MOV RDI, RAX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MOV RAX, 0x2000001
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SYSCALL
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>íŒŒì‹±ëœ AST ì˜ ì²« ì›ì†Œê°€ ìš°ë¦¬ê°€ ì‚¬ìš©í•  ê²°ê³¼ì´ë‹¤. macOS ì—ì„œ ì»´íŒŒì¼í•˜ê¸° ìœ„í•´ ì¶”ê°€í•œ ì½”ë“œëŠ” ì €ì¥ì†Œë¥¼ ì‚´í´ ë³´ë„ë¡ í•œë‹¤.&lt;/p>
&lt;p>ëŒ€ëµ ê°œìš”ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ts" data-lang="ts">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">export&lt;/span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">ExitCode&lt;/span>: &lt;span style="color:#66d9ef">Record&lt;/span>&amp;lt;&lt;span style="color:#f92672">string&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">,&lt;/span> &lt;span style="color:#a6e22e">string&lt;/span>&amp;gt; &lt;span style="color:#f92672">=&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">darwin&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#e6db74">&amp;#39;0x2000001&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">default&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#e6db74">&amp;#39;60&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ì´ì œ ì§„ì§œ ì–´ì…ˆë¸” í•´ ì‹¤í–‰ íŒŒì¼(ë°”ì´ë„ˆë¦¬)ë¥¼ ë§Œë“¤ì–´ ë³´ì.&lt;/p>
&lt;h2 id="ì‹¤í–‰-ì½”ë“œ-ìƒì„±">ì‹¤í–‰ ì½”ë“œ ìƒì„±&lt;/h2>
&lt;p>í…ŒìŠ¤íŠ¸ ì½”ë“œ ëŸ¬ë„ˆë¥¼ Phil ì˜ ë¬¸ì„œì™€ ê°™ì´ &lt;code>ulisp&lt;/code> ì´ë€ íŒŒì¼ë¡œ ë§Œë“¤ì–´ ì‹¤í–‰ ê°€ëŠ¥í•˜ê²Œ í•˜ê³  &lt;code>gcc&lt;/code> ëª…ë ¹ë„ í•¨ê»˜ ì‹¤í–‰ë˜ë„ë¡ í•˜ë©´ ì´ ì „ì²´ ë™ì‘ì„ í¬ì¥í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.&lt;/p>
&lt;p>&lt;code>ulisp&lt;/code> íŒŒì¼ì€ ì‹¤í–‰ ê¶Œí•œì„ ë¶€ì—¬í•˜ì—¬ &lt;code>node&lt;/code> ê°€ ìˆìœ¼ë©´ ìŠ¤ìŠ¤ë¡œ ì‹¤í–‰ ê°€ëŠ¥í•˜ë„ë¡ í•˜ê³  &lt;code>./tmp&lt;/code> í´ë”ì—ì„œ ì»´íŒŒì¼í•˜ê³  ì–´ì…ˆë¸”í•˜ê³  ì‹¤í–‰ íŒŒì¼ì„ ë§Œë“œëŠ”, ì†Œìœ„ íˆ´ì²´ì¸ í˜•ì‹ì„ ê°€ì§€ë„ë¡ í•´ë³´ì.&lt;/p>
&lt;p>ì†ŒìŠ¤ë¥¼ ì§€ì •í•˜ê³  ì‹¤í–‰ íŒŒì¼ì„ ë§Œë“¤ì–´ ë‚´ëŠ” ì ˆì°¨ë¥¼ ì¢€ ê·¸ëŸ´ ë“¯ í•˜ê²Œ ê°€ì ¸ê°€ ë³´ë ¤ í–ˆì§€ë§Œ ì–´ì§œí”¼ í•œ ì¤„ì˜ S-Expression êµ¬ë¬¸ì„ ì»´íŒŒì¼í•˜ëŠ” ê²ƒì´ ì „ë¶€ì¸ ê´€ê³„ë¡œ ê·¸ëƒ¥ ì•„ë˜ì™€ ê°™ì€ í˜•ì‹ìœ¼ë¡œ ëª…ë ¹ì„ ì‹¤í–‰í•˜ë„ë¡ í•˜ì.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>$ ulisp.js &lt;span style="color:#e6db74">&amp;#39;(+ 3 (+ 2 1))&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>ì´ ê³¼ì •ì„ ê²ªìœ¼ë©° ì•Œê²Œëœ ì‚¬ì‹¤ì¸ë° ìš°ë¦¬ í”„ë¡œê·¸ë¨ì˜ ì—”íŠ¸ë¦¬ í¬ì¸íŠ¸ë¡œ ì‚¬ìš©í•˜ëŠ” &lt;code>_main_&lt;/code> ì€ ì˜ëª»ëœ ì‹ë³„ìì˜€ë‹¤. ì •ìƒ ë™ì‘ì„ ìœ„í•´ &lt;code>_main&lt;/code> ìœ¼ë¡œ ë³€ê²½í•˜ì˜€ë‹¤.&lt;/p>
&lt;/blockquote>
&lt;p>ì–´ì…ˆë¸”ë¦¬ë¥¼ ì»´íŒŒì¼í•˜ê¸° ìœ„í•´ &lt;code>gcc&lt;/code> ë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤. gcc ëŠ” gnu compiler collection ì˜ ì•½ìë¡œ ë‹¤ì–‘í•œ ì½”ë“œë¥¼ ì»´íŒŒì¼ í•  ìˆ˜ ìˆë‹¤. ì–´ì…ˆë¸”ë¦¬ ì»´íŒŒì¼(ì–´ì…ˆë¸”)í•˜ê¸° ìœ„í•´ ì•„ë˜ì™€ ê°™ì€ ëª…ë ¹ì„ ì‚¬ìš©í•œë‹¤.&lt;/p>
&lt;p>&lt;code>gcc ì˜µì…˜ -o ì¶œë ¥íŒŒì¼ì´ë¦„ ì†ŒìŠ¤íŒŒì¼ì´ë¦„&lt;/code>&lt;/p>
&lt;p>ulisp.js ì˜ ì „ì²´ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#!/usr/bin/env node
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> { &lt;span style="color:#a6e22e">writeFileSync&lt;/span> } &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">require&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;fs&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> { &lt;span style="color:#a6e22e">execSync&lt;/span> } &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">require&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;child_process&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> { &lt;span style="color:#a6e22e">parse&lt;/span>, &lt;span style="color:#a6e22e">compile&lt;/span> } &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">require&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;./lib&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">CC&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;gcc&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">SOURCE&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;program.S&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">function&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(&lt;span style="color:#a6e22e">args&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">script&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">args&lt;/span>[&lt;span style="color:#ae81ff">2&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#a6e22e">script&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">console&lt;/span>.&lt;span style="color:#a6e22e">log&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;no source&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">program&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">compile&lt;/span>(&lt;span style="color:#a6e22e">parse&lt;/span>(&lt;span style="color:#a6e22e">script&lt;/span>)[&lt;span style="color:#ae81ff">0&lt;/span>][&lt;span style="color:#ae81ff">0&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">writeFileSync&lt;/span>(&lt;span style="color:#a6e22e">SOURCE&lt;/span>, &lt;span style="color:#a6e22e">program&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">execSync&lt;/span>(&lt;span style="color:#e6db74">`&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>&lt;span style="color:#a6e22e">CC&lt;/span>&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74"> -mstackrealign -masm=intel -o program &lt;/span>&lt;span style="color:#e6db74">${&lt;/span>&lt;span style="color:#a6e22e">SOURCE&lt;/span>&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">`&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">console&lt;/span>.&lt;span style="color:#a6e22e">log&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;done; \nrun ./program and echo $? for output&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">main&lt;/span>(&lt;span style="color:#a6e22e">process&lt;/span>.&lt;span style="color:#a6e22e">argv&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ì‹¤í–‰ í”Œë˜ê·¸ë¥¼ ì£¼ëŠ” ë°©ë²•ì€ &lt;code>chmod +x ulisp.js&lt;/code> ì´ë‹¤. ë§ˆì§€ë§‰ ë¡œê·¸ë¥¼ ë³´ë©´ ì•Œê² ì§€ë§Œ ìš°ë¦¬ í”„ë¡œê·¸ë¨ì€ ê·¸ëƒ¥ ì¢…ë£Œí•  ë¿ì´ê³  í™”ë©´ì— ì¶œë ¥í•˜ëŠ” ì‹œìŠ¤í…œ ì½œì€ ì—†ë‹¤.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>$ ./ulisp.js &lt;span style="color:#e6db74">&amp;#39;(+ 3 (+ 2 1))&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">done&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>run ./program and echo $? &lt;span style="color:#66d9ef">for&lt;/span> output
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ file program &lt;span style="color:#75715e"># or use hexyl to see hex binary&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>program: Mach-O 64-bit executable x86_64
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ ./program
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ echo $?
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">6&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ì´ë ‡ê²Œ ì²« í¬ìŠ¤íŠ¸ê°€ ë§ˆë¬´ë¦¬ ë˜ì—ˆë‹¤. ì´ì–´ì§€ëŠ” ë‚´ìš©ì€ ì¢€ ë” ê·¸ëŸ´ë“¯í•œ í”„ë¡œê·¸ë¨ì„ ìœ„í•´ í•¨ìˆ˜ë¥¼ ì„ ì–¸í•˜ê³  ì´ë¥¼ ì‚¬ìš©í•˜ëŠ” í”„ë¡œê·¸ë¨ ì½”ë“œë¥¼ ì»´íŒŒì¼í•˜ëŠ” ê³¼ì •ì„ ë‹´ê³  ìˆë‹¤.&lt;/p>
&lt;h2 id="ì„œë¸Œ-ë£¨í‹´">ì„œë¸Œ ë£¨í‹´&lt;/h2>
&lt;p>ë³´í†µ í•¨ìˆ˜ë‚˜ í”„ë¡œì‹œì ¸ë¥¼ ì„œë¸Œë£¨í‹´ì˜ ì¼ë¶€ë¡œ ë³¸ë‹¤. ì„œë¸Œë£¨í‹´ì€ ë°˜ë³µë˜ëŠ” ì½”ë“œë¥¼ ì¬ì‚¬ìš©í•˜ê¸° ìœ„í•œ ë°©ë²•ìœ¼ë¡œ ë°˜í™˜í•˜ëŠ” ê°’ì´ ìˆìœ¼ë©´ ë³´í†µ í•¨ìˆ˜, ë°˜í™˜í•˜ëŠ” ê°’ì´ ì—†ëŠ” ê²½ìš°ëŠ” í”„ë¡œì‹œì ¸ë¡œ ë¶ˆë ¸ëŠ”ë° ì§€ê¸ˆì€ í¬ê²Œ êµ¬ë¶„í•˜ì—¬ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í¸ì´ë‹¤. ì½”ë“œ ë°˜ë³µì´ë‚˜ ì¬ì‚¬ìš©ì„ ìœ„í•œ ê°€ì¥ ì¤‘ìš”í•œ ì—­í• ì„ í•œë‹¤. ì´í•˜ ì¼ë°˜ì ìœ¼ë¡œ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” í•¨ìˆ˜ë¼ëŠ” í‘œí˜„ì„ ì‚¬ìš©í•˜ê² ë‹¤.&lt;/p>
&lt;blockquote>
&lt;p>ì„œë¸Œë£¨í‹´ì€ ì½”ë£¨í‹´ê³¼ í•¨ê»˜ ì½”ë“œ íë¦„ì„ ë‚˜íƒ€ë‚¸ë‹¤.&lt;/p>
&lt;/blockquote>
&lt;p>í•¨ìˆ˜ë¥¼ êµ¬ì„±í•¨ì— ìˆì–´ ë¯¸ë¦¬ ì•Œì•„ë‘ì–´ì•¼ í•  ê²ƒì´ ìˆë‹¤.&lt;/p>
&lt;ol>
&lt;li>ê°’ì„ ì „ë‹¬í•˜ëŠ” ë°©ë²•ì€ ì´ì „ì— ì‚´í´ë³¸ ê²ƒê³¼ ê°™ì´ ìŠ¤íƒì„ ì‚¬ìš©í•œë‹¤.&lt;/li>
&lt;li>í•¨ìˆ˜ ìˆ˜ì‹ ìì™€ í•¨ìˆ˜ í˜¸ì¶œì ì‚¬ì´ì˜ ê·œì¹™ê³¼ í•¨ìˆ˜ê°€ ì‚¬ìš©í•˜ëŠ” ë³€ìˆ˜(ì‹ë³„ì)ì— ëŒ€í•œ ìƒì¡´ ë²”ìœ„(Life-time)ë¥¼ ê´€ë¦¬í•˜ê³  ì •ì˜í•´ì•¼ í•œë‹¤.&lt;/li>
&lt;/ol>
&lt;p>í•¨ìˆ˜ ì •ì˜ êµ¬ë¬¸ì€ ì•„ë˜ì™€ ê°™ì€ í‘œí˜„ì„ ì‚¬ìš©í•˜ê¸°ë¡œ í•œë‹¤.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-scheme" data-lang="scheme">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#a6e22e">def&lt;/span> main ()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (+ &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>))
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ì´ì œ ìš°ë¦¬ê°€ ë§Œë“œëŠ” í”„ë¡œê·¸ë˜ë° ì–¸ì–´ëŠ” &lt;code>main&lt;/code> í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê¸°ë¡œ ì•½ì†í•˜ì—¬ í”„ë¡œê·¸ë¨ì˜ ì—”íŠ¸ë¦¬í¬ì¸íŠ¸entrypoint ë¼ê³  ë¶ˆë¦¬ëŠ” ê°œë…ì„ êµ¬í˜„í•˜ê¸°ë¡œ í•œë‹¤.&lt;/p>
&lt;p>ìš°ë¦¬ê°€ ë§Œë“  S-expression íŒŒì„œëŠ” ì´ ìƒˆë¡œìš´ êµ¬ë¬¸ì„ ì˜ íŒŒì‹±í•œë‹¤.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">program&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;(def main () (+ 1 2))&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>runner.js&lt;/code> íŒŒì¼ì— ìˆëŠ” í”„ë¡œê·¸ë¨ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì—¬ íŒŒì‹±í•´ ë³´ì.&lt;/p>
&lt;p>Phil ì˜ ë³¸ë¬¸ì— ìˆëŠ” node repl ì—ì„œ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ë„ ìœ ìš©í•˜ë‹ˆ ê²½í—˜í•´ ë³´ë„ë¡ í•˜ì.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>Welcome to Node.js v19.3.0.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Type &lt;span style="color:#e6db74">&amp;#34;.help&amp;#34;&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> more information.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; const &lt;span style="color:#f92672">{&lt;/span> parse &lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#f92672">=&lt;/span> require&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#e6db74">&amp;#39;./lib/parser&amp;#39;&lt;/span>&lt;span style="color:#f92672">)&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>undefined
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; JSON.stringify&lt;span style="color:#f92672">(&lt;/span>parse&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#e6db74">&amp;#39;(def main () (+ 1 2))&amp;#39;&lt;/span>&lt;span style="color:#f92672">))&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#39;[[[&amp;#34;def&amp;#34;,&amp;#34;main&amp;#34;,[0],[&amp;#34;+&amp;#34;,1,2]]],&amp;#34;&amp;#34;]&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>íƒ€ì… ì •ë³´ê°€ ë‹¤ë¥¸ê²Œ ìˆëŠ”ì§€ &amp;ldquo;main&amp;rdquo; ë’¤ì— &lt;code>[0]&lt;/code> ìˆëŠ”ë° ë‚˜ì¤‘ì— ë‹¤ì‹œ ì ê²€í•´ ë³´ê¸°ë¡œ í•œë‹¤.&lt;/p>
&lt;p>íŒŒì‹±ì€ ì¼ë‹¨ ë˜ë‹ˆ ì´ ê²°ê³¼ë¥¼ ì»´íŒŒì¼í•˜ëŠ” ì½”ë“œë¥¼ ë³´ê°•í•´ ë³´ë„ë¡ í•œë‹¤.&lt;/p>
&lt;p>ìš°ì„  &lt;code>def&lt;/code> ëŠ” ì‚¬ìš©ìê°€ ì •ì˜í•˜ëŠ” í‚¤ì›Œë“œê°€ ì•„ë‹ˆê³  ì´ ì–¸ì–´ ì‹œìŠ¤í…œì˜ ê³ ìœ í•œ í‚¤ì›Œë“œì´ë‹¤. ì—¬ê¸°ì—ì„œëŠ” &amp;ldquo;primitive&amp;rdquo; ë¼ê³  ë¶€ë¥´ê³  ìˆë‹¤.&lt;/p>
&lt;p>ì´ë ‡ê²Œ ì›ì‹œ í•¨ìˆ˜ë¥¼ ëª¨ì•„ë‘ëŠ” ê°ì²´ë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ ë‘”ë‹¤. ê·¸ë¦¬ê³  compile fn call í•¨ìˆ˜ì—ì„œ ì›ì‹œprimitive í•¨ìˆ˜ë¥¼ ë”°ë¡œ ì²˜ë¦¬í•˜ëŠ” ê¸°ëŠ¥ì„ ì¶”ê°€í•  ê²ƒì´ë‹¤.&lt;/p>
&lt;p>ê·¸ ì „ì— ì¸ìê°€ ì—†ëŠ” ê¹¡í†µ í•¨ìˆ˜ë¥¼ ì„ ì–¸í•˜ê³  ìˆëŠ” def main () ì½”ë“œê°€ ì •ìƒì ìœ¼ë¡œ íŒŒì‹± ë˜ë„ë¡ parser ë¥¼ ìˆ˜ì •í•´ ë³´ì.&lt;/p>
&lt;p>ë¬¸ì œëŠ” ì—¬ëŠ” ê´„í˜¸ê°€ ë¸”ë¡ì„ ì‹œì‘í•˜ëŠ” ê²ƒë„ ìˆì§€ë§Œ ì¸ìë¥¼ ì„ ì–¸í•˜ëŠ” ì˜ì—­ì˜ ì‹œì‘ìœ¼ë¡œë„ ì‚¬ìš©ëœë‹¤ëŠ” ì ì´ë‹¤. ìš°ë¦¬ì˜ ê¸°ë³¸ ì½”ë“œëŠ” ì¸ìê°€ ì—†ëŠ” ìƒíƒœë¡œ ì œê³µë˜ê³  ìˆê³  ì´ëŠ” ë¹ˆ expression ìœ¼ë¡œ ë°˜í™˜ë˜ì–´ì•¼ í•œë‹¤.&lt;/p>
&lt;p>Phil ì˜ ì €ì¥ì†Œì— ìˆëŠ” ì½”ë“œë¥¼ ì°¸ê³ í•˜ì—¬ íŒŒì„œë¥¼ ìˆ˜ì •í•˜ì.&lt;/p>
&lt;p>ê´„í˜¸ë¥¼ ë‹«ëŠ” ê³¼ì •ì— ì €ì¥ëœ í† í°ì´ ì—†ëŠ” ê²½ìš°ì— ëŒ€í•œ ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ ì¶”ê°€í•´ì•¼ í•œë‹¤.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ts" data-lang="ts">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#a6e22e">index&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; &lt;span style="color:#a6e22e">index&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#a6e22e">program&lt;/span>.&lt;span style="color:#a6e22e">length&lt;/span>; &lt;span style="color:#a6e22e">index&lt;/span>&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;)&amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// check for parameter section in function declaration
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#a6e22e">currentToken&lt;/span>.&lt;span style="color:#a6e22e">length&lt;/span> &lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">tokens&lt;/span>.&lt;span style="color:#a6e22e">push&lt;/span>(&lt;span style="color:#a6e22e">getToken&lt;/span>(&lt;span style="color:#a6e22e">currentToken&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;span style="color:#a6e22e">tokens&lt;/span>, &lt;span style="color:#a6e22e">program&lt;/span>.&lt;span style="color:#a6e22e">substring&lt;/span>(&lt;span style="color:#a6e22e">index&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>)];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">default&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ì•„ì§ ì–´ì…ˆë¸”ë¦¬ë¡œ ì»´íŒŒì¼ì€ ë˜ì§€ ì•Šì§€ë§Œ íŒŒì„œì˜ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ëŠ” í†µê³¼í•˜ê²Œ ëœë‹¤.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ts" data-lang="ts">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">it&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;should parse def main function expression&amp;#39;&lt;/span>, () &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">source&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;(def main () (+ 1 2))&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">expected&lt;/span> &lt;span style="color:#f92672">=&lt;/span> [[[&lt;span style="color:#e6db74">&amp;#39;def&amp;#39;&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;main&amp;#39;&lt;/span>, [], [&lt;span style="color:#e6db74">&amp;#39;+&amp;#39;&lt;/span>, &lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>]]], &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">result&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">parse&lt;/span>(&lt;span style="color:#a6e22e">source&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">expect&lt;/span>(&lt;span style="color:#a6e22e">result&lt;/span>).&lt;span style="color:#a6e22e">toEqual&lt;/span>(&lt;span style="color:#a6e22e">expected&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ë‹¤ìŒ í¬ìŠ¤íŠ¸ì— ì½”ë“œë¥¼ ìƒì„±í•˜ë©° í•¨ìˆ˜ ì •ì˜definitionì™€ í˜¸ì¶œ/í”¼í˜¸ì¶œì„ ë‚˜íƒ€ë‚¼ ë•Œ ìì£¼ ì‚¬ìš©ë˜ëŠ” caller/callee ë¥¼ í†µí•´ í•¨ìˆ˜ í˜¸ì¶œ ê·œì¹™ì„ ì‚´í´ ë³´ê³ , ì‹ë³„ìì˜ ìœ íš¨ ë²”ìœ„ë¥¼ ì œí•œí•˜ëŠ” scope ì— ëŒ€í•´ ì•Œì•„ë³´ê¸°ë¡œ í•˜ì.&lt;/p></content></item><item><title>Write Deadly Simple Compiler Part 2</title><link>https://faultnote.github.io/posts/write-simple-compiler-2/</link><pubDate>Sun, 27 Nov 2022 22:00:00 +0900</pubDate><author>soomtong@gmail.com (soomtong)</author><guid>https://faultnote.github.io/posts/write-simple-compiler-2/</guid><description>Phil ì˜ &amp;lsquo;Writing a lisp compiler from scratch in JavaScript&amp;rsquo; ì²« í¬ìŠ¤íŠ¸ì˜ ë‘ ë²ˆì§¸ íŒŒíŠ¸ì¸ë° ë¶„ëŸ‰ì´ ë§ì•„ ìƒˆ í¬ìŠ¤íŠ¸ë¥¼ ì—´ì—ˆë‹¤. ì§€ë‚œ í¬ìŠ¤íŠ¸ì— ì´ì–´ì„œ&amp;hellip; Phil ì˜ ê°€ì´ë“œëŠ” S-expression ì„ ë°°ì—´ ë°ì´í„°ë¡œ ë§Œë“¤ê³ </description><content>&lt;blockquote>
&lt;p>&lt;a href="https://notes.eatonphil.com">Phil&lt;/a> ì˜ &amp;lsquo;Writing a lisp compiler from scratch in JavaScript&amp;rsquo; ì²« í¬ìŠ¤íŠ¸ì˜ ë‘ ë²ˆì§¸ íŒŒíŠ¸ì¸ë° ë¶„ëŸ‰ì´ ë§ì•„ ìƒˆ í¬ìŠ¤íŠ¸ë¥¼ ì—´ì—ˆë‹¤.&lt;/p>
&lt;/blockquote>
&lt;p>ì§€ë‚œ í¬ìŠ¤íŠ¸ì— ì´ì–´ì„œ&amp;hellip;&lt;/p>
&lt;p>Phil ì˜ ê°€ì´ë“œëŠ” S-expression ì„ ë°°ì—´ ë°ì´í„°ë¡œ ë§Œë“¤ê³  ì´ë¥¼ ì–´ì…ˆë¸”ë¦¬ ì½”ë“œ(í…ìŠ¤íŠ¸)ë¡œ ê¸°ë¡í•˜ë„ë¡ í•˜ê³  ìˆë‹¤. ê·¸í›„ ì–´ì…ˆë¸”ëŸ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤í–‰ ê°€ëŠ¥í•œ ë°”ì´ë„ˆë¦¬ íŒŒì¼ì„ ë§Œë“ ë‹¤.&lt;/p>
&lt;p>ì–´ì…ˆë¸”ë¦¬ëŠ” ë³´í†µì˜ ì‚¬ëŒì´ ì½ì„ ìˆ˜ ìˆëŠ” ê°€ì¥ ë‚®ì€ ìˆ˜ì¤€ì˜ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë¡œ CPU ì˜ ì‹¤ì œ ëª…ë ¹ê³¼ 1:1 ë¡œ ëŒ€ì‘ëœë‹¤. ê·¸ë˜ì„œ ìƒì„±ëœ ë°”ì´ë„ˆë¦¬ ì½”ë“œëŠ” ì–´ì…ˆë¸”ë¦¬ë¡œ ì‰½ê²Œ ë³€í™˜ ê°€ëŠ¥í•˜ë‹¤.&lt;/p>
&lt;p>ì–´ì…ˆë¸”ë¦¬ëŠ” ì„ í˜•ìœ¼ë¡œ êµ¬ì„±ëœë‹¤. ë¹„êµì™€ ë°˜ë³µì„ í†µí•´ procedual í•˜ê²Œ ì½”ë“œê°€ ì‹¤í–‰ëœë‹¤. í•¨ìˆ˜ê°€ í˜¸ì¶œë  ë•Œ íŠ¹ì • ë ˆì§€ìŠ¤í„°ì— ì¸ìë¥¼ ë‹´ì•„ë‘ê³  í•¨ìˆ˜ê°€ ì¢…ë£Œë˜ë©´ íŠ¹ì • ë ˆì§€ìŠ¤í„°ì— ë°˜í™˜ ê°’ì´ ë‹´ê¸´ í›„ ë‹¤ìŒ ëª…ë ¹ìœ¼ë¡œ ë˜ëŒì•„ê°€ê¸° ìœ„í•´ ì•½ì†ëœ ë ˆì§€ìŠ¤í„°ë¥¼ ì°¸ì¡°í•œë‹¤.&lt;/p>
&lt;p>ê·œì¹™ë§Œ ì˜ ì•Œë©´ ë‹¨ìˆœí•˜ê³  ì½ê¸° ì‰½ë‹¤&amp;hellip;ğŸ¤¯ ì–´ì¨‹ë“ , ìš°ë¦¬ì˜ í”„ë¡œê·¸ë¨ë“¤ì€ ì´ ê³¼ì •ì´ ë§¤ìš° ë¹ ë¥´ê²Œ ë°˜ë³µë˜ëŠ” ê²ƒ ë¿ì´ë‹¤.&lt;/p>
&lt;blockquote>
&lt;p>ê° CPU ì œì¡°ì‚¬ ë§ˆë‹¤ CPU ë¥¼ ìœ„í•œ ëª…ë ¹ì–´(OpCode) ì„¸íŠ¸ê°€ ìˆê³  ìš°ë¦¬ëŠ” ì´ê±¸ ISA, Instruction Set Architecture ë¼ê³  ë¶€ë¥¸ë‹¤.&lt;/p>
&lt;/blockquote>
&lt;p>ì´ í¬ìŠ¤íŠ¸ì—ì„œëŠ” x86_64 ê¸°ì¤€, &lt;code>RDI&lt;/code>, &lt;code>RSI&lt;/code>, &lt;code>RDX&lt;/code> ë ˆì§€ìŠ¤í„°ì— ì¸ìë¥¼ ë‹´ê³ , &lt;code>RAX&lt;/code> ë ˆì§€ì„œí„°ì— ë°˜í™˜ ê°’ì„ ë‹´ê¸°ë¡œ í•œë‹¤. í•¨ìˆ˜ í˜¸ì¶œì‹œ ê°’ì„ ë‹´ëŠ” ì£¼ì²´ë„ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ìª½ìœ¼ë¡œ í•˜ì.&lt;/p>
&lt;p>ì–´ì…ˆë¸”ë¦¬ í”„ë¡œê·¸ë¨ì€ section ìœ¼ë¡œ êµ¬ë¶„ë˜ì–´ ìˆë‹¤. &lt;code>text&lt;/code> ì˜ì—­ì—ëŠ” ì½ê¸°ë§Œ ê°€ëŠ¥í•œ í”„ë¡œê·¸ë¨ì˜ ì½”ë“œ, ëª…ë ¹ë“¤ì´ ìˆê³  CPU ëŠ” ì´ ëª…ë ¹ë“¤ì„ ì‹¤í–‰í•˜ë©° ë‹¤ìŒìœ¼ë¡œ ì´ë™í•œë‹¤. ì´ë™ ê³¼ì •ì— CALL, RET, JMP ë“± ë‹¤ìŒ ëª…ë ¹ì–´ì˜ ìœ„ì¹˜ë¥¼ ë³€ê²½í•˜ëŠ” ëª…ë ¹ì„ ë§Œë‚˜ ì´ë™í•˜ê¸°ë„ í•˜ê³  ë³µê·€í•˜ê¸°ë„ í•œë‹¤.&lt;/p>
&lt;p>ê·¸ë¦¬ê³  ì¤‘ìš”í•œ ë¶€ë¶„ìœ¼ë¡œ ë³´í†µ, í”„ë¡œê·¸ë¨ì˜ ì‹œì‘ ìœ„ì¹˜ë¥¼ ì •ì˜í•˜ëŠ” ë¶€ë¶„ì¸ &lt;code>.global main&lt;/code> ë„ í•„ìš”í•˜ë‹¤.
main ì€ goto ë¥¼ ìœ„í•œ í”í•œ ë¼ë²¨ì´ë‹¤. main ì´ë¼ëŠ” ë¼ë²¨ì´ ì‚¬ìš©ë  ìˆ˜ ìˆìœ¼ë‹ˆ ìš°ë¦¬ í”„ë¡œê·¸ë¨ì˜ ì‹œì‘ì€ &lt;code>_main_&lt;/code> ì„ ì‚¬ìš©í•˜ë„ë¡ í•˜ê² ë‹¤.&lt;/p>
&lt;p>ê° ì–´ì…ˆë¸”ë¦¬ ì½”ë“œë¥¼ ìƒì„±í•˜ëŠ” emit ì´ë¼ëŠ” í•¨ìˆ˜ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ìš°ë¦¬ê°€ ê°€ì§„ AST ë°ì´í„°ë¥¼ ì–´ì…ˆë¸”ë¦¬ ì½”ë“œë¡œ ë³€í™˜í•´ ë³´ì.&lt;/p>
&lt;h2 id="ì½”ë“œ-ìƒì„±">ì½”ë“œ ìƒì„±&lt;/h2>
&lt;p>emit í•¨ìˆ˜ê°€ ìƒì„±í•˜ëŠ” ê²°ê³¼ëŠ” ì†ŒìŠ¤ ì½”ë“œê°€ ëœë‹¤. ë“¤ì—¬ì“°ê¸°ë¥¼ ìœ„í•´ depth ì™€ ê¸°ë¡í•  code ë¥¼ ì¸ìë¡œ ë°›ì.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ts" data-lang="ts">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">makeIndent&lt;/span> &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#a6e22e">length&lt;/span>: &lt;span style="color:#66d9ef">number&lt;/span>) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#a6e22e">indentSpace&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#a6e22e">i&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">length&lt;/span>; &lt;span style="color:#a6e22e">i&lt;/span> &lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; &lt;span style="color:#a6e22e">i&lt;/span> &lt;span style="color:#f92672">-=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">indentSpace&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;\t&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">indentSpace&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">function&lt;/span> &lt;span style="color:#a6e22e">emit&lt;/span>(&lt;span style="color:#a6e22e">indentDepth&lt;/span>: &lt;span style="color:#66d9ef">number&lt;/span>, &lt;span style="color:#a6e22e">code&lt;/span>: &lt;span style="color:#66d9ef">string&lt;/span>, &lt;span style="color:#a6e22e">print&lt;/span>: &lt;span style="color:#66d9ef">boolean&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>)&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">dump&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">`&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>&lt;span style="color:#a6e22e">makeIndent&lt;/span>(&lt;span style="color:#a6e22e">indentDepth&lt;/span>)&lt;span style="color:#e6db74">}${&lt;/span>&lt;span style="color:#a6e22e">code&lt;/span>&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">`&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#a6e22e">print&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">console&lt;/span>.&lt;span style="color:#a6e22e">log&lt;/span>(&lt;span style="color:#a6e22e">dump&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#e6db74">`&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>&lt;span style="color:#a6e22e">dump&lt;/span>&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#e6db74">n`&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ì •ìƒ ë™ì‘ì„ í™•ì¸í•˜ê¸° ìœ„í•œ ë‹¨ìˆœí•œ í…ŒìŠ¤íŠ¸ íŒŒì¼ë„ ì¶”ê°€í•´ ë³¸ë‹¤.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ts" data-lang="ts">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">import&lt;/span> { &lt;span style="color:#a6e22e">emit&lt;/span> } &lt;span style="color:#66d9ef">from&lt;/span> &lt;span style="color:#e6db74">&amp;#39;./compiler&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">describe&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;Emit tab spaces&amp;#39;&lt;/span>, () &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">it&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;should return tabbed spaces with text&amp;#39;&lt;/span>, () &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">expected&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;\t\thello&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">result&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">emit&lt;/span>(&lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;hello&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">expect&lt;/span>(&lt;span style="color:#a6e22e">result&lt;/span>).&lt;span style="color:#a6e22e">toEqual&lt;/span>(&lt;span style="color:#a6e22e">expected&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ì´ì–´ì„œ í•¨ìˆ˜ ì¸ìargumentë¥¼ ì²˜ë¦¬í•˜ëŠ” ì½”ë“œì™€ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³  ê²°ê³¼ë¥¼ ì €ì¥í•˜ëŠ” ì½”ë“œë¥¼ ìƒì„±í•˜ëŠ” compile arguement, compile function(label) call í•¨ìˆ˜ë¥¼ êµ¬ì„±í•´ ë³´ì.&lt;/p>
&lt;p>ìš°ë¦¬ê°€ ê°€ì§„ AST êµ¬ì¡°ë¥¼ ìƒê°í•´ ë³´ì.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#e6db74">&amp;#39;+&amp;#39;&lt;/span>, &lt;span style="color:#ae81ff">1&lt;/span>, [&lt;span style="color:#e6db74">&amp;#39;+&amp;#39;&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#ae81ff">3&lt;/span>]]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ì—°ì‚°ìëŠ” ì–´ì…ˆë¸”ë¦¬ë¡œ êµ¬ì„±ëœ í•¨ìˆ˜ê°€ ë˜ê³  ìˆ«ìëŠ” ë ˆì§€ìŠ¤í„°ì— í• ë‹¹ë  ê°’ë“¤ì´ ëœë‹¤. í•¨ìˆ˜ëŠ” í•¨ìˆ˜ ë¼ë²¨ë¡œ í‘œê¸°í•˜ì—¬ CPU ëª…ë ¹ ì²˜ë¦¬ê¸°ê°€ Jump í•  ìˆ˜ ìˆë„ë¡ í•˜ê³  ê° ìˆ«ìëŠ” ë¦¬í„°ëŸ´ì´ ëœë‹¤.&lt;/p>
&lt;p>ì–´ì…ˆë¸”ë¦¬ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ì€ í˜•ì‹ìœ¼ë¡œ ì‹œì‘í•˜ê³  ì‹œìŠ¤í…œ ì½œì„ í†µí•´ ì¢…ë£Œëœë‹¤. (ì˜ˆì‹œëŠ” ìš”ì¦˜ macOS ê¸°ì¤€)&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-asm" data-lang="asm">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">.global&lt;/span> &lt;span style="color:#66d9ef">_main_&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">.text&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// í”„ë¡œê·¸ë¨ ì½”ë“œ...
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-asm" data-lang="asm">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// í”„ë¡œê·¸ë¨ ì½”ë“œ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">MOV&lt;/span> &lt;span style="color:#66d9ef">RDI&lt;/span>, &lt;span style="color:#66d9ef">RAX&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">MOV&lt;/span> &lt;span style="color:#66d9ef">RAX&lt;/span>, &lt;span style="color:#ae81ff">0x2000001&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">SYSCALL&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ìš°ë¦¬ì˜ ìƒ˜í”Œ AST ëŠ” ë‘ ë²ˆì˜ &lt;code>ADD&lt;/code> ì—°ì‚°ì„ í•˜ê²Œ ë  ì˜ˆì •ì´ê³  ì´ í•¨ìˆ˜ëŠ” &lt;code>plus:&lt;/code> ë¼ëŠ” ë¼ë²¨ì„ ë‹¬ê³  ì¬ì‚¬ìš©í•  ê²ƒì´ë‹¤.&lt;/p>
&lt;p>ì–´ì…ˆë¸”ë¦¬ ìˆ˜ì¤€ì—ì„œ í•¨ìˆ˜ í˜¸ì¶œ ê¸°ëŠ¥ì€ ì•„ë˜ì™€ ê°™ì€ í˜•ì‹ìœ¼ë¡œ êµ¬ì„±ë  ìˆ˜ ìˆë‹¤.&lt;/p>
&lt;ol>
&lt;li>ì—°ì‚°ì— ì‚¬ìš©ë  ì¸ìë¥¼ ë ˆì§€ìŠ¤í„°ì— ì €ì¥í•˜ê¸° ìœ„í•´ ë ˆì§€ìŠ¤í„°ì˜ ì´ì „ ê°’ì„ ì €ì¥ â†’ ê° ë ˆì§€ìŠ¤í„°ë¥¼ ìŠ¤íƒì— ì €ì¥ â†’ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜ ì¸ìì— ê°¯ìˆ˜ ë§Œí¼ë§Œ ìŠ¤íƒì— ì˜¬ë¦¬ë©´ ëœë‹¤.&lt;/li>
&lt;li>ìš°ë¦¬ ìˆ˜ì¤€ì—ì„œ, ìµœëŒ€ 3ê°œê¹Œì§€ ì‚¬ìš© ê°€ëŠ¥í•œ ì¸ìë“¤ì„ ë ˆì§€ìŠ¤í„°ì— ì €ì¥ (ìˆœì„œëŒ€ë¡œ)&lt;/li>
&lt;li>í•¨ìˆ˜ í˜¸ì¶œ â†’ ë”í•˜ê¸° ê¸°ëŠ¥ì„ í•˜ëŠ” í”„ë¡œì‹œì ¸ë¡œ ì´ë™ â†’ ì½”ë“œ ì‹¤í–‰ í›„ RET ëª…ë ¹ìœ¼ë¡œ ë³µê·€&lt;/li>
&lt;li>ìŠ¤íƒì— ì €ì¥ëœ ë ˆì§€ìŠ¤í„° ê°’ì„ ë³µì› (ì €ì¥í•œ ì—­ìˆœìœ¼ë¡œ)&lt;/li>
&lt;li>ê²°ê³¼ ê°’ì´ ì €ì¥ëœ ë ˆì§€ìŠ¤í„°ì—ì„œ ê°’ì„ í™•ì¸&lt;/li>
&lt;/ol>
&lt;p>Phil ì˜ ì½”ë“œë¥¼ ì°¸ê³ ë¡œ ì¢€ ë” ì§„í–‰í•´ ë³´ì.&lt;/p>
&lt;p>íŒŒë¼ë¯¸í„°ë¥¼ ìœ„í•œ 3ê°œì˜ ë ˆì§€ìŠ¤í„°ë¥¼ ì¤€ë¹„í•˜ê³ , ì–´ì…ˆë¸”ë¦¬ ë‚´ì¥ í•¨ìˆ˜ë¥¼ ê°ì‹¼ plus í•¨ìˆ˜ ë¼ë²¨ë„ ì¤€ë¹„í•´ ë‘ì—ˆë‹¤.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ts" data-lang="ts">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">enum&lt;/span> &lt;span style="color:#a6e22e">OpCode&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;+&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;+&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">enum&lt;/span> &lt;span style="color:#a6e22e">Register&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">RDI&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;RDI&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">RSI&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;RSI&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">RDX&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;RDX&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">RAX&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;RAX&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">ArgRegisters&lt;/span>: &lt;span style="color:#66d9ef">Register&lt;/span>[] &lt;span style="color:#f92672">=&lt;/span> [&lt;span style="color:#a6e22e">Register&lt;/span>.&lt;span style="color:#a6e22e">RDI&lt;/span>, &lt;span style="color:#a6e22e">Register&lt;/span>.&lt;span style="color:#a6e22e">RSI&lt;/span>, &lt;span style="color:#a6e22e">Register&lt;/span>.&lt;span style="color:#a6e22e">RDX&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">BuiltinFunctions&lt;/span>: &lt;span style="color:#66d9ef">Record&lt;/span>&amp;lt;&lt;span style="color:#f92672">OpCode&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">,&lt;/span> &lt;span style="color:#a6e22e">string&lt;/span>&amp;gt; &lt;span style="color:#f92672">=&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;+&amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#e6db74">&amp;#39;plus&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>í•¨ìˆ˜ í˜¸ì¶œ ìƒì„±í•˜ê¸° ìœ„í•œ compileFnCall í•¨ìˆ˜ë¥¼ ì‘ì„±í•´ ë³´ì. ìœ„ì—ì„œ ì•ˆë‚´í•œ pseudo ì½”ë“œë¥¼ ì˜®ê¸°ë©´ ëœë‹¤.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ts" data-lang="ts">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">function&lt;/span> &lt;span style="color:#a6e22e">compileFnCall&lt;/span>(&lt;span style="color:#a6e22e">functionLabel&lt;/span>: &lt;span style="color:#66d9ef">OpCode&lt;/span>, &lt;span style="color:#a6e22e">args&lt;/span>: &lt;span style="color:#66d9ef">Literal&lt;/span>[], &lt;span style="color:#a6e22e">destination?&lt;/span>: &lt;span style="color:#66d9ef">string&lt;/span>)&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#a6e22e">dump&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">dump&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#a6e22e">args&lt;/span>.&lt;span style="color:#a6e22e">reduce&lt;/span>((&lt;span style="color:#a6e22e">acc&lt;/span>, &lt;span style="color:#a6e22e">_&lt;/span>, &lt;span style="color:#a6e22e">index&lt;/span>) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">acc&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#a6e22e">emit&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#e6db74">`PUSH &lt;/span>&lt;span style="color:#e6db74">${&lt;/span>&lt;span style="color:#a6e22e">ArgRegisters&lt;/span>[&lt;span style="color:#a6e22e">index&lt;/span>]&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">`&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }, &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">dump&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#a6e22e">args&lt;/span>.&lt;span style="color:#a6e22e">reduce&lt;/span>((&lt;span style="color:#a6e22e">acc&lt;/span>, &lt;span style="color:#a6e22e">arg&lt;/span>, &lt;span style="color:#a6e22e">index&lt;/span>) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">acc&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#a6e22e">compileArgument&lt;/span>(&lt;span style="color:#a6e22e">arg&lt;/span>, &lt;span style="color:#a6e22e">ArgRegisters&lt;/span>[&lt;span style="color:#a6e22e">index&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }, &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">dump&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#a6e22e">emit&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#e6db74">`CALL &lt;/span>&lt;span style="color:#e6db74">${&lt;/span>&lt;span style="color:#a6e22e">BuiltinFunctions&lt;/span>[&lt;span style="color:#a6e22e">functionLabel&lt;/span>] &lt;span style="color:#f92672">||&lt;/span> &lt;span style="color:#a6e22e">functionLabel&lt;/span>&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">`&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">dump&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#a6e22e">args&lt;/span>.&lt;span style="color:#a6e22e">reduceRight&lt;/span>((&lt;span style="color:#a6e22e">acc&lt;/span>, &lt;span style="color:#a6e22e">_&lt;/span>, &lt;span style="color:#a6e22e">index&lt;/span>) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">acc&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#a6e22e">emit&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#e6db74">`POP &lt;/span>&lt;span style="color:#e6db74">${&lt;/span>&lt;span style="color:#a6e22e">ArgRegisters&lt;/span>[&lt;span style="color:#a6e22e">index&lt;/span>]&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">`&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }, &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#a6e22e">destination&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">dump&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#a6e22e">emit&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#e6db74">`MOV &lt;/span>&lt;span style="color:#e6db74">${&lt;/span>&lt;span style="color:#a6e22e">destination&lt;/span>&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">, &lt;/span>&lt;span style="color:#e6db74">${&lt;/span>&lt;span style="color:#a6e22e">Register&lt;/span>.&lt;span style="color:#a6e22e">RDX&lt;/span>&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">`&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">dump&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ìŠ¤íƒì— ì˜¬ë¦° ê¸°ì¡´ ë ˆì§€ìŠ¤í„° ê°’ë“¤ì€ ì—­ìˆœìœ¼ë¡œ ë³µì›í•˜ê¸° ìœ„í•´ reduceRight ë¥¼ ì‚¬ìš©í–ˆë‹¤.&lt;/p>
&lt;p>ë‹¤ì‹œ í•œ ë²ˆ ìš°ë¦¬ì˜ AST ë¥¼ ë³´ì.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#e6db74">&amp;#39;+&amp;#39;&lt;/span>, &lt;span style="color:#ae81ff">1&lt;/span>, [&lt;span style="color:#e6db74">&amp;#39;+&amp;#39;&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#ae81ff">3&lt;/span>]]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ì¸ì ë³´ê´€ìš©ìœ¼ë¡œ ì‚¬ìš©í•  ë ˆì§€ìŠ¤í„°ë¥¼ ìŠ¤íƒì— ì˜¬ë ¤ ë‘ì—ˆë‹¤ë©´ AST ì˜ ì²« ë²ˆì§¸ ì¸ìë¥¼ OpCode ë¡œ í• ë‹¹í•˜ê³  ì´ì–´ì§€ëŠ” ì¸ìë¥¼ OpCode ì˜ ì¸ìê°€ ë  ë¦¬í„°ëŸ´ë¡œ ê°„ì£¼í•˜ì—¬ ë ˆì§€ìŠ¤í„°ì— ì˜¬ë ¤ë‘ì–´ì•¼ í•œë‹¤.&lt;/p>
&lt;p>ì´ ê³¼ì •ì—ì„œ ì´ì–´ì§€ëŠ” ì¸ìê°€ ë°°ì—´ì¸ ê²½ìš°ëŠ” ë˜ ë‹¤ë¥¸ í•¨ìˆ˜ í˜¸ì¶œì´ ì˜ˆìƒë˜ê¸° ë•Œë¬¸ì— ë˜ ë‹¤ì‹œ OpCode ê°€ í˜¸ì¶œë˜ëŠ” ì¬ê·€ í•¨ìˆ˜ êµ¬ì„±ì„ ê°€ì§€ê²Œ ëœë‹¤.&lt;/p>
&lt;p>ê·¸ë˜ì„œ ì¸ìë¥¼ compile í•˜ëŠ” í•¨ìˆ˜ëŠ” ì¸ìê°€ ë°°ì—´ì¼ ê²½ìš°ë¥¼ êµ¬ë¶„í•˜ì—¬ ì–´ìƒ˜ë¸”ë¦¬ ì½”ë“œë¥¼ emit í•˜ë„ë¡ í•˜ì.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ts" data-lang="ts">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">function&lt;/span> &lt;span style="color:#a6e22e">compileArgument&lt;/span>(&lt;span style="color:#a6e22e">arg&lt;/span>: &lt;span style="color:#66d9ef">Literal&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#a6e22e">Literal&lt;/span>[], &lt;span style="color:#a6e22e">destination&lt;/span>: &lt;span style="color:#66d9ef">string&lt;/span>)&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (Array.&lt;span style="color:#a6e22e">isArray&lt;/span>(&lt;span style="color:#a6e22e">arg&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> [&lt;span style="color:#a6e22e">opcode&lt;/span>, ...&lt;span style="color:#a6e22e">rest&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">arg&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">compileFnCall&lt;/span>(&lt;span style="color:#a6e22e">opcode&lt;/span> &lt;span style="color:#66d9ef">as&lt;/span> &lt;span style="color:#a6e22e">OpCode&lt;/span>, &lt;span style="color:#a6e22e">rest&lt;/span>, &lt;span style="color:#a6e22e">destination&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">emit&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#e6db74">`MOV &lt;/span>&lt;span style="color:#e6db74">${&lt;/span>&lt;span style="color:#a6e22e">destination&lt;/span>&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">, &lt;/span>&lt;span style="color:#e6db74">${&lt;/span>&lt;span style="color:#a6e22e">arg&lt;/span>&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">`&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ë°°ì—´ì´ ì•„ë‹Œ ì¼ë°˜ ë¦¬í„°ëŸ´ì´ë¼ë©´ ëŒ€ìƒ ë ˆì§€ìŠ¤í„°ì— ê°’ì„ ì§€ì •í•˜ëŠ” ê²ƒìœ¼ë¡œ ì¶©ë¶„í•˜ë‹¤.&lt;/p>
&lt;p>ì´ì œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì¶”ê°€í•˜ê³  AST ë¥¼ ë°›ì•„ ì–´ì…ˆë¸”ë¦¬ë¡œ ì»´íŒŒì¼í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ì.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ts" data-lang="ts">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">describe&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;Emit compiled code for arguments with destication&amp;#39;&lt;/span>, () &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">it&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;should return single move statement&amp;#39;&lt;/span>, () &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">expected&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;\tMOV RDI, 1\n&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">result&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">compileArgument&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;RDI&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">expect&lt;/span>(&lt;span style="color:#a6e22e">result&lt;/span>).&lt;span style="color:#a6e22e">toEqual&lt;/span>(&lt;span style="color:#a6e22e">expected&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">it&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;should call compileCall function when got array of arguments&amp;#39;&lt;/span>, () &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">expected&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">`&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#e6db74">tPUSH RDI
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> // ...`&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">result&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">compileArgument&lt;/span>([&lt;span style="color:#e6db74">&amp;#39;+&amp;#39;&lt;/span>, &lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>], &lt;span style="color:#e6db74">&amp;#39;RSI&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">expect&lt;/span>(&lt;span style="color:#a6e22e">result&lt;/span>).&lt;span style="color:#a6e22e">toEqual&lt;/span>(&lt;span style="color:#a6e22e">expected&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">describe&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;Emit compiled code for function call with opcode and arguments&amp;#39;&lt;/span>, () &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">it&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;should return basic assembly code&amp;#39;&lt;/span>, () &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">expected&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">`&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#e6db74">tPUSH RDI
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> // ...`&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">result&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">compileFnCall&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;+&amp;#39;&lt;/span> &lt;span style="color:#66d9ef">as&lt;/span> &lt;span style="color:#a6e22e">OpCode&lt;/span>, [&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">expect&lt;/span>(&lt;span style="color:#a6e22e">result&lt;/span>).&lt;span style="color:#a6e22e">toEqual&lt;/span>(&lt;span style="color:#a6e22e">expected&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ì´ì œ ì–´ì…ˆë¸”ë¦¬ ë³¸ë¬¸ì„ ì™„ì„±í•´ ë³´ì. ë¨¼ì € prefix, postfix ìš© í•¨ìˆ˜ë¥¼ ì¶”ê°€í•˜ì. prefix ìª½ì— plus ë¼ë²¨ì„ ê°€ì§„ ADD í•¨ìˆ˜ë¥¼ ì‘ì„±í•´ ë‘ì—ˆë‹¤.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ts" data-lang="ts">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">function&lt;/span> &lt;span style="color:#a6e22e">emitPrefix() {&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">emit&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;.global _main_&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">emit&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;.text&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">emit&lt;/span>(&lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;plus:&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">emit&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;ADD RDI, RSI&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">emit&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;MOV RAX, RDI&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">emit&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;RET&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">emit&lt;/span>(&lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;_main_:&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">function&lt;/span> &lt;span style="color:#a6e22e">emitPostfix() {&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">emit&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;MOV RDI, RAX&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Set exit arg in macOS
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">emit&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;MOV RAX, 0x2000001&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Set syscall number
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">emit&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;SYSCALL&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ì´ ëª¨ë“  ì‘ì—…ì„ ì™„ì„±ì‹œí‚¬ compile í•¨ìˆ˜ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ts" data-lang="ts">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">function&lt;/span> &lt;span style="color:#a6e22e">compile&lt;/span>(&lt;span style="color:#a6e22e">ast&lt;/span>: &lt;span style="color:#66d9ef">Literal&lt;/span>[]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> [&lt;span style="color:#a6e22e">opcode&lt;/span>, ...&lt;span style="color:#a6e22e">rest&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">ast&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">emitPrefix&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">compileFnCall&lt;/span>(&lt;span style="color:#a6e22e">opcode&lt;/span> &lt;span style="color:#66d9ef">as&lt;/span> &lt;span style="color:#a6e22e">OpCode&lt;/span>, &lt;span style="color:#a6e22e">rest&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">emitPostfix&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>ê° emit í•¨ìˆ˜ê°€ ë°˜í™˜í•˜ëŠ” ê°’ì„ ëª¨ì•„ì„œ ì²˜ë¦¬í•˜ëŠ” êµ¬ë¬¸ì€ ìƒëµë˜ì—ˆìœ¼ë‹ˆ ì €ì¥ì†Œì˜ ì†ŒìŠ¤ì½”ë“œë¥¼ ì°¸ê³ ;
&lt;a href="https://github.com/soomtong/simple-lisp-compiler">https://github.com/soomtong/simple-lisp-compiler&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;p>ì‚¬ìš©ëœ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‚´í´ ë³´ì.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ts" data-lang="ts">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">describe&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;Emit basic AST into assembly code&amp;#39;&lt;/span>, () &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">it&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;should emit a assembly code!&amp;#39;&lt;/span>, () &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">expected&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">`// skipped whitespace
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> .global _main_
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> .text
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">plus:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> ADD RDI, RSI
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> MOV RAX, RDI
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> RET
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">_main_:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> PUSH RDI
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> // ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> MOV RAX, 0x2000001
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> SYSCALL
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">`&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">result&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">compile&lt;/span>([&lt;span style="color:#e6db74">&amp;#39;+&amp;#39;&lt;/span>, &lt;span style="color:#ae81ff">1&lt;/span>, [&lt;span style="color:#e6db74">&amp;#39;+&amp;#39;&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#ae81ff">3&lt;/span>]]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">expect&lt;/span>(&lt;span style="color:#a6e22e">result&lt;/span>).&lt;span style="color:#a6e22e">toEqual&lt;/span>(&lt;span style="color:#a6e22e">expected&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ìë™ìœ¼ë¡œ ìŠ¤íƒì´ ê´€ë¦¬ë˜ëŠ” ê²ƒì´ ì´í•´ë˜ë©´ ë‹¤ìŒ íŒŒíŠ¸ë¡œ ì´ë™í•´ ë³´ì.&lt;/p></content></item><item><title>Write Deadly Simple Compiler Part 1</title><link>https://faultnote.github.io/posts/write-simple-compiler-1/</link><pubDate>Sat, 19 Nov 2022 22:00:00 +0900</pubDate><author>soomtong@gmail.com (soomtong)</author><guid>https://faultnote.github.io/posts/write-simple-compiler-1/</guid><description>ë‚´ê°€ ì²˜ìŒìœ¼ë¡œ êµ¬ë…í•œ ê°œì¸ ë©”ì¼ì¸ Phil ì˜ ì›¹ í˜ì´ì§€ì— ìˆëŠ” 2018ë…„ ë§ í¬ìŠ¤íŠ¸ì¸ &amp;lsquo;Writing a lisp compiler from scratch in JavaScript&amp;rsquo; ë¥¼ í•™ìŠµí•˜ë©° ê¸°ë¡í•œ ê¸€ì´ë‹¤. ìš°ì„  Node í™˜ê²½ì—ì„œ êµ¬ë™ë˜ëŠ” Lisp ì»´íŒŒì¼ëŸ¬ë¥¼</description><content>&lt;blockquote>
&lt;p>ë‚´ê°€ ì²˜ìŒìœ¼ë¡œ êµ¬ë…í•œ ê°œì¸ ë©”ì¼ì¸ &lt;a href="https://notes.eatonphil.com">Phil&lt;/a> ì˜ ì›¹ í˜ì´ì§€ì— ìˆëŠ” 2018ë…„ ë§ í¬ìŠ¤íŠ¸ì¸ &amp;lsquo;Writing a lisp compiler from scratch in JavaScript&amp;rsquo; ë¥¼ í•™ìŠµí•˜ë©° ê¸°ë¡í•œ ê¸€ì´ë‹¤.&lt;/p>
&lt;/blockquote>
&lt;p>ìš°ì„  Node í™˜ê²½ì—ì„œ êµ¬ë™ë˜ëŠ” Lisp ì»´íŒŒì¼ëŸ¬ë¥¼ êµ¬í˜„í•˜ëŠ” íˆ¬í† ë¦¬ì–¼ì„ ë”°ë¼ê°€ ë³´ë„ë¡ í•œë‹¤. ë³¸ë¬¸ì€ ì—¬ê¸°ì— ìˆë‹¤.&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://notes.eatonphil.com/compiler-basics-lisp-to-assembly.html">https://notes.eatonphil.com/compiler-basics-lisp-to-assembly.html&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>ì‹œë¦¬ì¦ˆì˜ ëª©í‘œëŠ” ì•„ë˜ì™€ ê°™ì€ ì½”ë“œë¥¼ ê³„ì‚°í•˜ëŠ” í”„ë¡œê·¸ë¨ì„ ë§Œë“œëŠ” ê²ƒì´ë‹¤.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-scheme" data-lang="scheme">&lt;span style="display:flex;">&lt;span>(+ &lt;span style="color:#ae81ff">1&lt;/span> (+ (&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>)))
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ì´ ê³¼ì •ì—ì„œ &amp;lsquo;íŒŒì‹±&amp;rsquo;, &amp;lsquo;ì½”ë“œ ìƒì„±&amp;rsquo;, &amp;lsquo;ì–´ì…ˆë¸”ë¦¬ ê¸°ë³¸&amp;rsquo;, &amp;lsquo;ì‹œìŠ¤í…œ ì½œ&amp;rsquo; ì— ëŒ€í•œ ë‚´ìš©ì„ ë‹¤ë£¨ì§€ë§Œ &amp;lsquo;í•¨ìˆ˜ ì •ì˜&amp;rsquo;, &amp;lsquo;ë¹„ ì‹¬ë³¼/ë¹„ ì‚°ìˆ  ë°ì´í„° íƒ€ì…&amp;rsquo;, &amp;lsquo;3ê°œ ì´ìƒì˜ ì¸ì ì „ë‹¬&amp;rsquo;, &amp;lsquo;ì˜ˆì™¸ ì²˜ë¦¬&amp;rsquo;, &amp;lsquo;ì—ëŸ¬ í•¸ë“¤ë§&amp;rsquo; ë“±ì€ ë‹¤ë£¨ì§€ ì•ŠëŠ”ë‹¤.&lt;/p>
&lt;h2 id="íŒŒì‹±">íŒŒì‹±&lt;/h2>
&lt;p>ì´ ê°•ì˜ëŠ” ë³´í†µ lisp ê³„ì—´ì˜ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì—ì„œ ì‚¬ìš©ë˜ëŠ” S-expression ë¬¸ë²•ì„ ì²˜ë¦¬í•˜ëŠ” ì»´íŒŒì¼ëŸ¬ë¥¼ ë§Œë“œëŠ” ê²ƒì´ë‹¤. S-expression(Symbolic expression)ì€ êµ¬ì¡°ì ì¸ ë°ì´í„°ë¥¼ í‘œí˜„í•˜ëŠ” ë°©ë²• ì¤‘ í•˜ë‚˜ë¡œ ì´ ë¬¸ë²•ì€ ë¹„êµì  íŒŒì‹±í•˜ê¸° ì‰½ê¸° ë•Œë¬¸ì— ê°ì¢… êµ¬ë¬¸ íŠ¸ë¦¬ë¥¼ í‘œí˜„í•˜ëŠ” ì–¸ì–´ë¡œ ì„ íƒë˜ê³¤ í•œë‹¤. ê·¸ë˜ì„œ ë§ì€ íŒŒì„œë“¤ì˜ ì¶”ìƒí™” ë‹¨ê³„ë¡œ S-expression ì„ ì‚¬ìš©í•œë‹¤. ì´ ë‚´ìš©ì— ëŒ€í•´ì„œëŠ” ë‹¤ë¥¸ í¬ìŠ¤íŠ¸ë¡œ ì •ë¦¬í•  ì˜ˆì •ì´ë‹¤.&lt;/p>
&lt;p>ê·¸ë¦¬ê³ , ìš°ë¦¬ì˜ í”„ë¡œê·¸ë¨ì€ ê¸°ëŠ¥ì´ ì œí•œì ì´ê¸° ë•Œë¬¸ì— ë ‰ì‹±lexingê³¼ íŒŒì‹±parsing ë‹¨ê³„ë¥¼ ë‚˜ëˆ„ì§€ ì•Šê³  ì§„í–‰í•œë‹¤.&lt;/p>
&lt;p>ë ‰ì„œì™€ íŒŒì„œë¥¼ í†µí•´ ì»´íŒŒì¼ëŸ¬ë¥¼ ë§Œë“œëŠ” ê²ƒì€ ë‹¤ìŒ ê¸°íšŒì— ì‚´í´ë³´ì. ë˜ëŠ” íŒŒì„œì™€ ë ‰ì„œë¥¼ ë§Œë“¤ì–´ ë³´ëŠ” ì‹œê°„ì„ ê°€ì§€ëŠ” ê²ƒë„ ì¢‹ê² ë‹¤.&lt;/p>
&lt;blockquote>
&lt;p>ì–¸ì–´ ë¬¸ë²•ì„ ë””ìì¸í•˜ê³  íŒŒì‹±í•˜ê³  ë ‰ì‹±í•˜ëŠ” ìœ ëª…í•œ ì†Œí”„íŠ¸ì›¨ì–´ë“¤ì´ ìˆë‹¤. í•´ë‹¹ ì–¸ì–´ë¥¼ ìœ„í•œ íŒŒì„œë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” í”„ë¡œê·¸ë¨ë„ ìˆë‹¤. lex, yacc, bison, menhir, peg, antlr, lalrpop ë“± ë³¸ê²©ì ìœ¼ë¡œ ì–¸ì–´ë¥¼ ë§Œë“ ë‹¤ë©´ ì´ëŸ° íˆ´ì„ ì‚¬ìš©í•˜ì§€ ì•Šì„ê¹Œ?
&lt;a href="https://en.wikipedia.org/wiki/Comparison_of_parser_generators">https://en.wikipedia.org/wiki/Comparison_of_parser_generators&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;p>íŒŒì„œëŠ” &lt;code>êµ¬ë¬¸ ì¶”ìƒ íŠ¸ë¦¬abstract syntax tree&lt;/code> ë¥¼ ë§Œë“¤ì–´ ë‚¸ë‹¤. íŠ¸ë¦¬ êµ¬ì¡°ëŠ” ì¤‘ì²©ëœ ë°°ì—´ë¡œ í‘œí˜„ëœë‹¤.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> (&lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>)) &lt;span style="color:#960050;background-color:#1e0010">â†’&lt;/span> [&lt;span style="color:#e6db74">&amp;#39;+&amp;#39;&lt;/span>, &lt;span style="color:#ae81ff">1&lt;/span>, [&lt;span style="color:#e6db74">&amp;#39;+&amp;#39;&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#ae81ff">3&lt;/span>]]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ì²˜ìŒ ì´ ê³¼ì œë¥¼ ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ì•„ë‹Œ ë‹¤ë¥¸/ìƒˆë¡œìš´ ì–¸ì–´ë¥¼ ê³µë¶€í•˜ë©´ì„œ ì—°ìŠµí•´ ë³´ë©´ì„œ êµ¬í˜„í•˜ë ¤ í–ˆë‹¤. í•˜ì§€ë§Œ, ë””ìì¸ë„ ì•ˆë‚˜ì™”ëŠ”ë° í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ê²ƒì²˜ëŸ¼ ì–´ìƒ‰í•œê²Œ ì§„ë„ê°€ ë‚˜ê°€ì§€ ì•Šì•˜ë‹¤. ìµìˆ™í•œ ì–¸ì–´ë¡œ ë¨¼ì € ì§„í–‰í•´ ë³´ì.&lt;/p>
&lt;ol>
&lt;li>TypeScript&lt;/li>
&lt;li>Grain&lt;/li>
&lt;li>Zig&lt;/li>
&lt;/ol>
&lt;p>ì •ë„ ê²½í—˜í•´ ë³´ë©´ ì–´ë–¨ê¹Œ ì‹¶ë‹¤.&lt;/p>
&lt;p>ë¨¼ì € parse í•¨ìˆ˜ë¥¼ ë§Œë“¤ì. parse í•¨ìˆ˜ëŠ” ì•„ë˜ì˜ í˜•íƒœë¥¼ ê°€ì§ˆ ê²ƒì´ë‹¤. íƒ€ì… ì •ë³´ëŠ” ê³¼ì •ì´ ì§„í–‰ë˜ë©´ì„œ ê°œì„ í•´ ê°„ë‹¤.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ts" data-lang="ts">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">export&lt;/span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">parse&lt;/span> &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#a6e22e">program&lt;/span>: &lt;span style="color:#66d9ef">unknown&lt;/span>)&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">unknown&lt;/span>[] &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">tokens&lt;/span>: &lt;span style="color:#66d9ef">unknown&lt;/span>[] &lt;span style="color:#f92672">=&lt;/span> [];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// todo:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;span style="color:#a6e22e">tokens&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ì†ŒìŠ¤ ì½”ë“œë¥¼ program ìœ¼ë¡œ ë°›ì•„ ì–´ë–¤ ì²˜ë¦¬ë¥¼ í•˜ì—¬ AST(abstract syntax tree)ë¥¼ ì–»ì–´ë‚¸ë‹¤. parse í•¨ìˆ˜ëŠ” ì²˜ë¦¬ê°€ ì„±ê³µí•˜ë©´ ë°˜í™˜ë˜ëŠ” ê²°ê³¼ì˜ ë‘ ë²ˆì§¸ ìš”ì†Œì— ë¹ˆ ë¬¸ìì—´ì„ ì „ë‹¬í•˜ëŠ” ê²ƒìœ¼ë¡œ ê·œì¹™ì„ ì‚¼ì•˜ë‹¤.&lt;/p>
&lt;blockquote>
&lt;p>ê·¸ë˜ë„ ì™œ ë°˜í™˜ì´ [tokens, &amp;lsquo;&amp;rsquo;] ì¸ì§€ ì•„ì§ ëª¨ë¥´ê² ë‹¤. ê·¸ëƒ¥ íƒ€ì…ì„ ì´ë ‡ê²Œ ì‘ì„±í•œ ê±°ë¼ë©´ ë‚˜ì¤‘ì— ë°”ê¾¸ë„ë¡ í•˜ì.&lt;/p>
&lt;/blockquote>
&lt;p>ê³µë°±ì´ë‚˜ ê´„í˜¸ë¥¼ ë§Œë‚  ë•Œê¹Œì§€ ë¬¸ìì—´ì„ ë”í•´ í† í°ì„ ë§Œë“¤ì–´ ì¶”ê°€í•˜ëŠ” ì½”ë“œë¡œ ê°œì„ í•´ ë³´ì.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ts" data-lang="ts">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">export&lt;/span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">parse&lt;/span> &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#a6e22e">program&lt;/span>: &lt;span style="color:#66d9ef">string&lt;/span>)&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">unknown&lt;/span>[] &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">tokens&lt;/span>&lt;span style="color:#f92672">:&lt;/span> (&lt;span style="color:#66d9ef">string&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#66d9ef">number&lt;/span>)[] &lt;span style="color:#f92672">=&lt;/span> [];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#a6e22e">currentToken&lt;/span>: &lt;span style="color:#66d9ef">string&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">char&lt;/span> &lt;span style="color:#66d9ef">of&lt;/span> &lt;span style="color:#a6e22e">program&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">switch&lt;/span> (&lt;span style="color:#a6e22e">char&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;(&amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// todo:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;)&amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// todo:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39; &amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">tokens&lt;/span>.&lt;span style="color:#a6e22e">push&lt;/span>(Number.isFinite(&lt;span style="color:#a6e22e">currentToken&lt;/span>) &lt;span style="color:#f92672">?&lt;/span> Number(&lt;span style="color:#a6e22e">currentToken&lt;/span>) &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#a6e22e">currentToken&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">currentToken&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">default&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">currentToken&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#a6e22e">char&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;span style="color:#a6e22e">tokens&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ê³„ì‚°ì„ ìœ„í•´ ìˆ«ìì¸ ê²½ìš°ëŠ” ì—°ì‚° ê°€ëŠ¥í•œ íƒ€ì…ìœ¼ë¡œ ë³€ê²½í•´ ì£¼ê³  ìˆë‹¤.&lt;/p>
&lt;p>ê·¸ ë‹¤ìŒì€ ê´„í˜¸ë¥¼ ë§Œë‚˜ê²Œ ë˜ëŠ” ê²½ìš°ë¥¼ ì²˜ë¦¬í•˜ì.&lt;/p>
&lt;p>ê´„í˜¸ë¥¼ ì—´ë©´ ë˜ ë‹¤ì‹œ íŒŒì‹±í•  ë¬¸ìì—´ì´ ë“¤ì–´ìˆë‹¤. ì¦‰, ì¬ê·€ ê°€ëŠ¥í•œ êµ¬ì¡°ë¼ëŠ” ê²ƒì´ë‹¤. ì—¬ëŠ” ê´„í˜¸ ì½”ë“œë¥¼ êµ¬í˜„í•˜ê¸° ì „ì— ë‹«ëŠ” ê´„í˜¸ë¥¼ ë¨¼ì € êµ¬ì„±í•˜ì.&lt;/p>
&lt;p>ë‹¨ì–´ë¥¼ ì½ë‹¤ê°€ ë‹«ëŠ” ê´„í˜¸ë¥¼ ë§Œë‚˜ë©´ ì—¬ê¸°ê¹Œì§€ í† í°ì„ ì €ì¥í•˜ê³  ì¬ê·€ í˜¸ì¶œí•œ parse í•¨ìˆ˜ì—ê²Œ í˜„ì¬ê¹Œì§€ ëª¨ì•„ë‘” í† í°ê³¼ ì´ì–´ì„œ ì²˜ë¦¬í•´ì•¼í•  ë‚¨ì€ ë¬¸ìì—´ì„ ë°˜í™˜í•œë‹¤.&lt;/p>
&lt;p>ë‚¨ì€ ë¬¸ìì—´ ë°˜í™˜ì„ ìœ„í•´ substring ì´ í•„ìš”í•´ for of ëŒ€ì‹  forEach ë¥¼ ì‚¬ìš©í•˜ê¸°ë¡œ í–ˆë‹¤.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ts" data-lang="ts">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">export&lt;/span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">parse&lt;/span> &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#a6e22e">program&lt;/span>: &lt;span style="color:#66d9ef">string&lt;/span>)&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">unknown&lt;/span>[] &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">tokens&lt;/span>&lt;span style="color:#f92672">:&lt;/span> (&lt;span style="color:#66d9ef">string&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#66d9ef">number&lt;/span>)[] &lt;span style="color:#f92672">=&lt;/span> [];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#a6e22e">currentToken&lt;/span>: &lt;span style="color:#66d9ef">string&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">program&lt;/span>.&lt;span style="color:#a6e22e">forEach&lt;/span>((&lt;span style="color:#a6e22e">char&lt;/span>: &lt;span style="color:#66d9ef">string&lt;/span>, &lt;span style="color:#a6e22e">index&lt;/span>: &lt;span style="color:#66d9ef">number&lt;/span>) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">switch&lt;/span> (&lt;span style="color:#a6e22e">char&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;(&amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// todo:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;)&amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;span style="color:#a6e22e">tokens&lt;/span>, &lt;span style="color:#a6e22e">program&lt;/span>.&lt;span style="color:#a6e22e">substring&lt;/span>(&lt;span style="color:#a6e22e">index&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>)];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39; &amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">tokens&lt;/span>.&lt;span style="color:#a6e22e">push&lt;/span>(Number.isFinite(&lt;span style="color:#a6e22e">currentToken&lt;/span>) &lt;span style="color:#f92672">?&lt;/span> Number(&lt;span style="color:#a6e22e">currentToken&lt;/span>) &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#a6e22e">currentToken&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">currentToken&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">default&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">currentToken&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#a6e22e">char&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;span style="color:#a6e22e">tokens&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ì´ì œ ì—¬ëŠ” ê´„í˜¸ì˜ ì½”ë“œë¥¼ êµ¬ì„±í•˜ì. ì¬ê·€ í˜¸ì¶œì´ ì‹œì‘ë˜ëŠ” êµ¬ê°„ì´ë‹¤.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ts" data-lang="ts">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">export&lt;/span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">parse&lt;/span> &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#a6e22e">program&lt;/span>: &lt;span style="color:#66d9ef">string&lt;/span>)&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">any&lt;/span>[] &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">tokens&lt;/span>&lt;span style="color:#f92672">:&lt;/span> (&lt;span style="color:#66d9ef">string&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#66d9ef">number&lt;/span>)[] &lt;span style="color:#f92672">=&lt;/span> [];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#a6e22e">currentToken&lt;/span>: &lt;span style="color:#66d9ef">string&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Array.&lt;span style="color:#66d9ef">from&lt;/span>(&lt;span style="color:#a6e22e">program&lt;/span>).&lt;span style="color:#a6e22e">forEach&lt;/span>((&lt;span style="color:#a6e22e">char&lt;/span>: &lt;span style="color:#66d9ef">string&lt;/span>, &lt;span style="color:#a6e22e">index&lt;/span>: &lt;span style="color:#66d9ef">number&lt;/span>) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">switch&lt;/span> (&lt;span style="color:#a6e22e">char&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;(&amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> [&lt;span style="color:#a6e22e">parsedToken&lt;/span>, &lt;span style="color:#a6e22e">rest&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">parse&lt;/span>(&lt;span style="color:#a6e22e">program&lt;/span>.&lt;span style="color:#a6e22e">substring&lt;/span>(&lt;span style="color:#a6e22e">index&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">tokens&lt;/span>.&lt;span style="color:#a6e22e">push&lt;/span>(&lt;span style="color:#a6e22e">parsedToken&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;)&amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;span style="color:#a6e22e">tokens&lt;/span>, &lt;span style="color:#a6e22e">program&lt;/span>.&lt;span style="color:#a6e22e">substring&lt;/span>(&lt;span style="color:#a6e22e">index&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>)];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39; &amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">tokens&lt;/span>.&lt;span style="color:#a6e22e">push&lt;/span>(Number.isFinite(&lt;span style="color:#a6e22e">currentToken&lt;/span>) &lt;span style="color:#f92672">?&lt;/span> Number(&lt;span style="color:#a6e22e">currentToken&lt;/span>) &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#a6e22e">currentToken&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">currentToken&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">default&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">currentToken&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#a6e22e">char&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;span style="color:#a6e22e">tokens&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ì •ìƒì ìœ¼ë¡œ ì¢…ë£Œë˜ëŠ” ê²½ìš° ë°˜í™˜ì€ íŒŒì‹±ëœ í† í° ë­‰ì¹˜ì™€ ë¹ˆ ë¬¸ìì—´ì¸ê²Œ ë‚©ë“ì´ ëœë‹¤. ë” ì´ìƒ íŒŒì‹±í•  ë¬¸ìì—´ì´ ì—†ì„ ë•Œì— í•´ë‹¹ë˜ëŠ” ê²ƒì´ë‹¤.&lt;/p>
&lt;p>ëŒ€ê°• ì´ ì¯¤ ë˜ë‹ˆ spec íŒŒì¼ì„ ë§Œë“¤ ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤. í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ë§Œë“¤ê³  íƒ€ì… ì •ë³´ë¥¼ ì œëŒ€ë¡œ êµ¬ì„±í•´ ë³´ì.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ts" data-lang="ts">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">import&lt;/span> { &lt;span style="color:#a6e22e">parse&lt;/span> } &lt;span style="color:#66d9ef">from&lt;/span> &lt;span style="color:#e6db74">&amp;#39;./parser&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">describe&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;Parse s-expression&amp;#39;&lt;/span>, () &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">it&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;should parse basic expression&amp;#39;&lt;/span>, () &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">source&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;(+ 3 (+ 1 2)&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">expected&lt;/span> &lt;span style="color:#f92672">=&lt;/span> [[[&lt;span style="color:#e6db74">&amp;#39;+&amp;#39;&lt;/span>, &lt;span style="color:#ae81ff">3&lt;/span>, [&lt;span style="color:#e6db74">&amp;#39;+&amp;#39;&lt;/span>, &lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>]]], &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">result&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">parse&lt;/span>(&lt;span style="color:#a6e22e">source&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">expect&lt;/span>(&lt;span style="color:#a6e22e">result&lt;/span>).&lt;span style="color:#a6e22e">toEqual&lt;/span>(&lt;span style="color:#a6e22e">expected&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ë”°ë¡œ ë¶„ë¦¬í•œ íƒ€ì… ì •ë³´ëŠ” ìš°ì„  ì´ ì •ë„ë¡œ êµ¬ì„±ë˜ì—ˆë‹¤.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ts" data-lang="ts">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">export&lt;/span> &lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Program&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">export&lt;/span> &lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Token&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#66d9ef">number&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#66d9ef">boolean&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#a6e22e">Token&lt;/span>[];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">export&lt;/span> &lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">ParsedTokens&lt;/span> &lt;span style="color:#f92672">=&lt;/span> [&lt;span style="color:#a6e22e">Token&lt;/span>, &lt;span style="color:#a6e22e">Program&lt;/span>];
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ì œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•ŠëŠ” ì²« íŒŒì„œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ts" data-lang="ts">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">import&lt;/span> &lt;span style="color:#66d9ef">type&lt;/span> { &lt;span style="color:#a6e22e">Program&lt;/span>, &lt;span style="color:#a6e22e">Token&lt;/span>, &lt;span style="color:#a6e22e">ParsedTokens&lt;/span> } &lt;span style="color:#66d9ef">from&lt;/span> &lt;span style="color:#e6db74">&amp;#39;./parser.type&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">export&lt;/span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">parse&lt;/span> &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#a6e22e">program&lt;/span>: &lt;span style="color:#66d9ef">Program&lt;/span>)&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#a6e22e">ParsedTokens&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">tokens&lt;/span>: &lt;span style="color:#66d9ef">Token&lt;/span>[] &lt;span style="color:#f92672">=&lt;/span> [];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#a6e22e">currentToken&lt;/span>: &lt;span style="color:#66d9ef">Token&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// eslint-disable-next-line @typescript-eslint/ban-ts-comment
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// @ts-ignore
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Array.&lt;span style="color:#66d9ef">from&lt;/span>(&lt;span style="color:#a6e22e">program&lt;/span>).&lt;span style="color:#a6e22e">forEach&lt;/span>((&lt;span style="color:#a6e22e">char&lt;/span>: &lt;span style="color:#66d9ef">string&lt;/span>, &lt;span style="color:#a6e22e">index&lt;/span>: &lt;span style="color:#66d9ef">number&lt;/span>) &lt;span style="color:#f92672">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">switch&lt;/span> (&lt;span style="color:#a6e22e">char&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;(&amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> [&lt;span style="color:#a6e22e">parsedToken&lt;/span>, &lt;span style="color:#a6e22e">rest&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">parse&lt;/span>(&lt;span style="color:#a6e22e">program&lt;/span>.&lt;span style="color:#a6e22e">substring&lt;/span>(&lt;span style="color:#a6e22e">index&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">tokens&lt;/span>.&lt;span style="color:#a6e22e">push&lt;/span>(&lt;span style="color:#a6e22e">parsedToken&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// reset rest and index?
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;)&amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">tokens&lt;/span>.&lt;span style="color:#a6e22e">push&lt;/span>(Number.isNaN(Number(&lt;span style="color:#a6e22e">currentToken&lt;/span>)) &lt;span style="color:#f92672">?&lt;/span> &lt;span style="color:#a6e22e">currentToken&lt;/span> : &lt;span style="color:#66d9ef">Number&lt;/span>(&lt;span style="color:#a6e22e">currentToken&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;span style="color:#a6e22e">tokens&lt;/span>, &lt;span style="color:#a6e22e">program&lt;/span>.&lt;span style="color:#a6e22e">substring&lt;/span>(&lt;span style="color:#a6e22e">index&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>)];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39; &amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">tokens&lt;/span>.&lt;span style="color:#a6e22e">push&lt;/span>(Number.isNaN(Number(&lt;span style="color:#a6e22e">currentToken&lt;/span>)) &lt;span style="color:#f92672">?&lt;/span> &lt;span style="color:#a6e22e">currentToken&lt;/span> : &lt;span style="color:#66d9ef">Number&lt;/span>(&lt;span style="color:#a6e22e">currentToken&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">currentToken&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">default&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">currentToken&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#a6e22e">char&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;span style="color:#a6e22e">tokens&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ì¬ê·€ í•¨ìˆ˜ë¥¼ í†µí•´ ì²˜ë¦¬ëœ ë‹¤ìŒ í”„ë¡œê·¸ë¨ì´ ë˜ ë‹¤ì‹œ íŒŒì‹±ë˜ì–´ ë°°ì—´ì´ í•„ìš” ì´ìƒ ì¤‘ì²©ë˜ëŠ” ê²°ê³¼ë¥¼ ë§Œë‚˜ê²Œ ëœë‹¤.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>console.dir
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">[&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">[&lt;/span> &lt;span style="color:#e6db74">&amp;#39;+&amp;#39;&lt;/span>, 3, &lt;span style="color:#f92672">[&lt;/span> &lt;span style="color:#e6db74">&amp;#39;+&amp;#39;&lt;/span>, 1, &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">]&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;+&amp;#39;&lt;/span>, 1, &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;+&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 3,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">[&lt;/span> &lt;span style="color:#e6db74">&amp;#39;+&amp;#39;&lt;/span>, 1, &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;+&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 1,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ì¬ê·€ í•¨ìˆ˜ë¥¼ í†µí•´ ë°˜í™˜ ëœ ë‚˜ë¨¸ì§€ í”„ë¡œê·¸ë¨ ì½”ë“œì— ëŒ€í•´ ë‹¤ì‹œ tokenize ë¥¼ í•  í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì— ì¬ê·€ í•¨ìˆ˜ë¥¼ í†µí•´ ì²˜ë¦¬ëœ í† í¬ì„ ì œì™¸í•œ ë‚˜ë¨¸ì§€ í”„ë¡œê·¸ë¨ë§Œ ì´ì „ parse ë‹¨ê³„ë¥¼ ê°€ì§€ë„ë¡ í”„ë¡œê·¸ë¨ ë¬¸ìì—´ì„ ì¶”ë ¤ ë‚¼ í•„ìš”ê°€ ìˆê²Œ ë˜ì–´ forEach ë¥¼ ì „í†µì ì¸ ì¸ë±ìŠ¤ë¥¼ ê°€ì§€ëŠ” for ë¬¸ìœ¼ë¡œ ë³€ê²½í•´ì•¼ í•œë‹¤.&lt;/p>
&lt;blockquote>
&lt;p>íŒŒì„œëŠ” ë¬¸ìì—´ ì»¤ì„œë¥¼ ì•ìœ¼ë¡œ ë’¤ë¡œ ì´ë™í•˜ë©° í† í°ì„ ìƒì„±í•´ ë‚´ëŠ”ë° ì¬ê·€ í•¨ìˆ˜ë¥¼ í†µí•´ ì²˜ë¦¬í•œ ë‚´ìš©ì€ ê±´ë„ˆ ë›°ì–´ì•¼ í•˜ëŠ” ê¸°ëŠ¥ì´ í•„ìš”í•œ ê²ƒì´ë‹¤.&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ts" data-lang="ts">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">getToken&lt;/span> &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#a6e22e">source&lt;/span>: &lt;span style="color:#66d9ef">Program&lt;/span>)&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#a6e22e">Token&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> (Number.isNaN(Number(&lt;span style="color:#a6e22e">source&lt;/span>)) &lt;span style="color:#f92672">?&lt;/span> &lt;span style="color:#a6e22e">source&lt;/span> : &lt;span style="color:#66d9ef">Number&lt;/span>(&lt;span style="color:#a6e22e">source&lt;/span>));
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ts" data-lang="ts">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#a6e22e">index&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; &lt;span style="color:#a6e22e">index&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#a6e22e">program&lt;/span>.&lt;span style="color:#a6e22e">length&lt;/span>; &lt;span style="color:#a6e22e">index&lt;/span>&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#a6e22e">char&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">program&lt;/span>.&lt;span style="color:#a6e22e">charAt&lt;/span>(&lt;span style="color:#a6e22e">index&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">switch&lt;/span> (&lt;span style="color:#a6e22e">char&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;(&amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> [&lt;span style="color:#a6e22e">parsedToken&lt;/span>, &lt;span style="color:#a6e22e">restProgram&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">parse&lt;/span>(&lt;span style="color:#a6e22e">program&lt;/span>.&lt;span style="color:#a6e22e">substring&lt;/span>(&lt;span style="color:#a6e22e">index&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">tokens&lt;/span>.&lt;span style="color:#a6e22e">push&lt;/span>(&lt;span style="color:#a6e22e">parsedToken&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// reset program with skipped by recursive and index to 0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">program&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">restProgram&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">index&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;)&amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">tokens&lt;/span>.&lt;span style="color:#a6e22e">push&lt;/span>(&lt;span style="color:#a6e22e">getToken&lt;/span>(&lt;span style="color:#a6e22e">currentToken&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;span style="color:#a6e22e">tokens&lt;/span>, &lt;span style="color:#a6e22e">program&lt;/span>.&lt;span style="color:#a6e22e">substring&lt;/span>(&lt;span style="color:#a6e22e">index&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>)];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39; &amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">tokens&lt;/span>.&lt;span style="color:#a6e22e">push&lt;/span>(&lt;span style="color:#a6e22e">getToken&lt;/span>(&lt;span style="color:#a6e22e">currentToken&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">currentToken&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">default&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">currentToken&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#a6e22e">char&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>íŒŒì‹± í•¨ìˆ˜ ë°˜ë³µë¬¸ì„ Phil ì˜ ì½”ë“œì— ë§ê²Œ ìˆ˜ì •í•˜ê³  &lt;code>npm t&lt;/code> ë¥¼ í†µí•´ í…ŒìŠ¤íŠ¸ë¥¼ ì„±ê³µì‹œì¼°ë‹¤.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&amp;gt; simple-compiler@0.1.0 test
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; jest
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> PASS src/parser.spec.ts
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Parse s-expression
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> âœ“ should parse basic expression &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> ms&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Test Suites: &lt;span style="color:#ae81ff">1&lt;/span> passed, &lt;span style="color:#ae81ff">1&lt;/span> total
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Tests: &lt;span style="color:#ae81ff">1&lt;/span> passed, &lt;span style="color:#ae81ff">1&lt;/span> total
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Snapshots: &lt;span style="color:#ae81ff">0&lt;/span> total
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Time: 1.161 s, estimated &lt;span style="color:#ae81ff">2&lt;/span> s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Ran all test suites.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ì´ì–´ íŒŒì‹±ëœ ë°ì´í„°ë¥¼ ì–´ì…ˆë¸”ë¦¬ë¡œ ë³€í™˜í•˜ëŠ” ë‹¨ê³„ë¡œ ë„˜ì–´ê°€ì.&lt;/p>
&lt;p>ì–´ì…ˆë¸”ë¦¬ë¥¼ ë°”ì´ë„ˆë¦¬ë¡œ ë³€í™˜í•˜ëŠ” ê²ƒì€ gcc ë‚˜ llvm ì˜ ë„ì›€ì„ ë°›ëŠ”ë‹¤.&lt;/p></content></item></channel></rss>