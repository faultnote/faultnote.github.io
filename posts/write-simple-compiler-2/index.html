<!doctype html><html lang=ko><head><title>Write Deadly Simple Compiler Part 2 :: FaultNote</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ë‚´ê°€ ì²˜ìŒìœ¼ë¡œ êµ¬ë…í•œ ê°œì¸ ë©”ì¼ì¸ Phil ì˜ ì›¹ í˜ì´ì§€ì— ìˆëŠ” 2018ë…„ ë§ í¬ìŠ¤íŠ¸ì¸ 'Writing a lisp compiler from scratch in JavaScript' ë¥¼ í•™ìŠµí•˜ë©° ê¸°ë¡í•œ ê¸€ì´ë‹¤."><meta name=keywords content="compiler,parser,asm,llvm"><meta name=robots content="noodp"><link rel=canonical href=https://faultnote.github.io/posts/write-simple-compiler-2/><script async src="https://www.googletagmanager.com/gtag/js?id=G-6J40Z181KC"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6J40Z181KC",{anonymize_ip:!1})}</script><link rel=stylesheet href=https://faultnote.github.io/assets/style.css><link rel=apple-touch-icon href=https://faultnote.github.io/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://faultnote.github.io/img/favicon/orange.png><meta name=twitter:card content="summary"><meta property="og:locale" content="ko"><meta property="og:type" content="article"><meta property="og:title" content="Write Deadly Simple Compiler Part 2"><meta property="og:description" content="ë‚´ê°€ ì²˜ìŒìœ¼ë¡œ êµ¬ë…í•œ ê°œì¸ ë©”ì¼ì¸ Phil ì˜ ì›¹ í˜ì´ì§€ì— ìˆëŠ” 2018ë…„ ë§ í¬ìŠ¤íŠ¸ì¸ 'Writing a lisp compiler from scratch in JavaScript' ë¥¼ í•™ìŠµí•˜ë©° ê¸°ë¡í•œ ê¸€ì´ë‹¤."><meta property="og:url" content="https://faultnote.github.io/posts/write-simple-compiler-2/"><meta property="og:site_name" content="FaultNote"><meta property="og:image" content="https://faultnote.github.io/img/favicon/orange.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2022-11-27 22:00:00 +0900 +0900"></head><body class=orange><div class="container headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>FaultNote</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>ì†Œê°œ</a></li><li><a href=/series>ì—°ì¬</a></li><li><a href=/blog>ë¸”ë¡œê·¸</a></li><div class=spacer></div><ul class=language-selector><ul class=language-selector-current><li>í•œêµ­ì–´ â–¾</li></ul><ul class="language-selector__more hidden"><li><a href=https://faultnote.github.io/en/>English</a></li><li><a href=https://faultnote.github.io/>í•œêµ­ì–´</a></li></ul></ul></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>ì†Œê°œ</a></li><li><a href=/series>ì—°ì¬</a></li><li><a href=/blog>ë¸”ë¡œê·¸</a></li><hr><li><a href=https://faultnote.github.io/en/>English</a></li><li><a href=https://faultnote.github.io/>í•œêµ­ì–´</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://faultnote.github.io/posts/write-simple-compiler-2/>Write Deadly Simple Compiler Part 2</a></h1><div class=post-meta><span class=post-date>2022-11-27</span>
<span class=post-author>:: soomtong</span>
<span class=post-reading-time>:: 5 min read (2209 words)</span></div><span class=post-tags>#<a href=https://faultnote.github.io/tags/compiler/>compiler</a>&nbsp;
#<a href=https://faultnote.github.io/tags/assembliy/>assembliy</a>&nbsp;
#<a href=https://faultnote.github.io/tags/javascript/>javascript</a>&nbsp;</span><div class=post-content><div><blockquote><p><a href=https://notes.eatonphil.com>Phil</a> ì˜ &lsquo;Writing a lisp compiler from scratch in JavaScript&rsquo; ì²« í¬ìŠ¤íŠ¸ì˜ ë‘ ë²ˆì§¸ íŒŒíŠ¸ì¸ë° ë¶„ëŸ‰ì´ ë§ì•„ ìƒˆ í¬ìŠ¤íŠ¸ë¥¼ ì—´ì—ˆë‹¤.</p></blockquote><p>ì§€ë‚œ í¬ìŠ¤íŠ¸ì— ì´ì–´ì„œ&mldr;</p><p>Phil ì˜ ê°€ì´ë“œëŠ” S-expression ì„ ë°°ì—´ ë°ì´í„°ë¡œ ë§Œë“¤ê³  ì´ë¥¼ ì–´ì…ˆë¸”ë¦¬ ì½”ë“œ(í…ìŠ¤íŠ¸)ë¡œ ê¸°ë¡í•˜ë„ë¡ í•˜ê³  ìˆë‹¤. ê·¸í›„ ì–´ì…ˆë¸”ëŸ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤í–‰ ê°€ëŠ¥í•œ ë°”ì´ë„ˆë¦¬ íŒŒì¼ì„ ë§Œë“ ë‹¤.</p><p>ì–´ì…ˆë¸”ë¦¬ëŠ” ë³´í†µì˜ ì‚¬ëŒì´ ì½ì„ ìˆ˜ ìˆëŠ” ê°€ì¥ ë‚®ì€ ìˆ˜ì¤€ì˜ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë¡œ CPU ì˜ ì‹¤ì œ ëª…ë ¹ê³¼ 1:1 ë¡œ ëŒ€ì‘ëœë‹¤. ê·¸ë˜ì„œ ìƒì„±ëœ ë°”ì´ë„ˆë¦¬ ì½”ë“œëŠ” ì–´ì…ˆë¸”ë¦¬ë¡œ ì‰½ê²Œ ë³€í™˜ ê°€ëŠ¥í•˜ë‹¤.</p><p>ì–´ì…ˆë¸”ë¦¬ëŠ” ì„ í˜•ìœ¼ë¡œ êµ¬ì„±ëœë‹¤. ë¹„êµì™€ ë°˜ë³µì„ í†µí•´ procedual í•˜ê²Œ ì½”ë“œê°€ ì‹¤í–‰ëœë‹¤. í•¨ìˆ˜ê°€ í˜¸ì¶œë  ë•Œ íŠ¹ì • ë ˆì§€ìŠ¤í„°ì— ì¸ìë¥¼ ë‹´ì•„ë‘ê³  í•¨ìˆ˜ê°€ ì¢…ë£Œë˜ë©´ íŠ¹ì • ë ˆì§€ìŠ¤í„°ì— ë°˜í™˜ ê°’ì´ ë‹´ê¸´ í›„ ë‹¤ìŒ ëª…ë ¹ìœ¼ë¡œ ë˜ëŒì•„ê°€ê¸° ìœ„í•´ ì•½ì†ëœ ë ˆì§€ìŠ¤í„°ë¥¼ ì°¸ì¡°í•œë‹¤.</p><p>ê·œì¹™ë§Œ ì˜ ì•Œë©´ ë‹¨ìˆœí•˜ê³  ì½ê¸° ì‰½ë‹¤&mldr;ğŸ¤¯ ì–´ì¨‹ë“ , ìš°ë¦¬ì˜ í”„ë¡œê·¸ë¨ë“¤ì€ ì´ ê³¼ì •ì´ ë§¤ìš° ë¹ ë¥´ê²Œ ë°˜ë³µë˜ëŠ” ê²ƒ ë¿ì´ë‹¤.</p><blockquote><p>ê° CPU ì œì¡°ì‚¬ ë§ˆë‹¤ CPU ë¥¼ ìœ„í•œ ëª…ë ¹ì–´(OpCode) ì„¸íŠ¸ê°€ ìˆê³  ìš°ë¦¬ëŠ” ì´ê±¸ ISA, Instruction Set Architecture ë¼ê³  ë¶€ë¥¸ë‹¤.</p></blockquote><p>ì´ í¬ìŠ¤íŠ¸ì—ì„œëŠ” x86_64 ê¸°ì¤€, <code>RDI</code>, <code>RSI</code>, <code>RDX</code> ë ˆì§€ìŠ¤í„°ì— ì¸ìë¥¼ ë‹´ê³ , <code>RAX</code> ë ˆì§€ì„œí„°ì— ë°˜í™˜ ê°’ì„ ë‹´ê¸°ë¡œ í•œë‹¤. í•¨ìˆ˜ í˜¸ì¶œì‹œ ê°’ì„ ë‹´ëŠ” ì£¼ì²´ë„ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ìª½ìœ¼ë¡œ í•˜ì.</p><p>ì–´ì…ˆë¸”ë¦¬ í”„ë¡œê·¸ë¨ì€ section ìœ¼ë¡œ êµ¬ë¶„ë˜ì–´ ìˆë‹¤. <code>text</code> ì˜ì—­ì—ëŠ” ì½ê¸°ë§Œ ê°€ëŠ¥í•œ í”„ë¡œê·¸ë¨ì˜ ì½”ë“œ, ëª…ë ¹ë“¤ì´ ìˆê³  CPU ëŠ” ì´ ëª…ë ¹ë“¤ì„ ì‹¤í–‰í•˜ë©° ë‹¤ìŒìœ¼ë¡œ ì´ë™í•œë‹¤. ì´ë™ ê³¼ì •ì— CALL, RET, JMP ë“± ë‹¤ìŒ ëª…ë ¹ì–´ì˜ ìœ„ì¹˜ë¥¼ ë³€ê²½í•˜ëŠ” ëª…ë ¹ì„ ë§Œë‚˜ ì´ë™í•˜ê¸°ë„ í•˜ê³  ë³µê·€í•˜ê¸°ë„ í•œë‹¤.</p><p>ê·¸ë¦¬ê³  ì¤‘ìš”í•œ ë¶€ë¶„ìœ¼ë¡œ ë³´í†µ, í”„ë¡œê·¸ë¨ì˜ ì‹œì‘ ìœ„ì¹˜ë¥¼ ì •ì˜í•˜ëŠ” ë¶€ë¶„ì¸ <code>.global main</code> ë„ í•„ìš”í•˜ë‹¤.
main ì€ goto ë¥¼ ìœ„í•œ í”í•œ ë¼ë²¨ì´ë‹¤. main ì´ë¼ëŠ” ë¼ë²¨ì´ ì‚¬ìš©ë  ìˆ˜ ìˆìœ¼ë‹ˆ ìš°ë¦¬ í”„ë¡œê·¸ë¨ì˜ ì‹œì‘ì€ <code>_main_</code> ì„ ì‚¬ìš©í•˜ë„ë¡ í•˜ê² ë‹¤.</p><p>ê° ì–´ì…ˆë¸”ë¦¬ ì½”ë“œë¥¼ ìƒì„±í•˜ëŠ” emit ì´ë¼ëŠ” í•¨ìˆ˜ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ìš°ë¦¬ê°€ ê°€ì§„ AST ë°ì´í„°ë¥¼ ì–´ì…ˆë¸”ë¦¬ ì½”ë“œë¡œ ë³€í™˜í•´ ë³´ì.</p><h2 id=ì½”ë“œ-ìƒì„±>ì½”ë“œ ìƒì„±<a href=#ì½”ë“œ-ìƒì„± class=hanchor arialabel=Anchor>&#8983;</a></h2><p>emit í•¨ìˆ˜ê°€ ìƒì„±í•˜ëŠ” ê²°ê³¼ëŠ” ì†ŒìŠ¤ ì½”ë“œê°€ ëœë‹¤. ë“¤ì—¬ì“°ê¸°ë¥¼ ìœ„í•´ depth ì™€ ê¸°ë¡í•  code ë¥¼ ì¸ìë¡œ ë°›ì.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>makeIndent</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>length</span>: <span style=color:#66d9ef>number</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>indentSpace</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>-=</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>indentSpace</span> <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#39;\t&#39;</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>indentSpace</span>;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>emit</span>(<span style=color:#a6e22e>indentDepth</span>: <span style=color:#66d9ef>number</span>, <span style=color:#a6e22e>code</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>print</span>: <span style=color:#66d9ef>boolean</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>dump</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>makeIndent</span>(<span style=color:#a6e22e>indentDepth</span>)<span style=color:#e6db74>}${</span><span style=color:#a6e22e>code</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>print</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>dump</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>dump</span><span style=color:#e6db74>}</span><span style=color:#960050;background-color:#1e0010>\</span><span style=color:#e6db74>n`</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ì •ìƒ ë™ì‘ì„ í™•ì¸í•˜ê¸° ìœ„í•œ ë‹¨ìˆœí•œ í…ŒìŠ¤íŠ¸ íŒŒì¼ë„ ì¶”ê°€í•´ ë³¸ë‹¤.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>emit</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;./compiler&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>describe</span>(<span style=color:#e6db74>&#39;Emit tab spaces&#39;</span>, () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>it</span>(<span style=color:#e6db74>&#39;should return tabbed spaces with text&#39;</span>, () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>expected</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;\t\thello&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>emit</span>(<span style=color:#ae81ff>2</span>, <span style=color:#e6db74>&#39;hello&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>result</span>).<span style=color:#a6e22e>toEqual</span>(<span style=color:#a6e22e>expected</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>ì´ì–´ì„œ í•¨ìˆ˜ ì¸ìargumentë¥¼ ì²˜ë¦¬í•˜ëŠ” ì½”ë“œì™€ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³  ê²°ê³¼ë¥¼ ì €ì¥í•˜ëŠ” ì½”ë“œë¥¼ ìƒì„±í•˜ëŠ” compile arguement, compile function(label) call í•¨ìˆ˜ë¥¼ êµ¬ì„±í•´ ë³´ì.</p><p>ìš°ë¦¬ê°€ ê°€ì§„ AST êµ¬ì¡°ë¥¼ ìƒê°í•´ ë³´ì.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>[<span style=color:#e6db74>&#39;+&#39;</span>, <span style=color:#ae81ff>1</span>, [<span style=color:#e6db74>&#39;+&#39;</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>]]
</span></span></code></pre></div><p>ì—°ì‚°ìëŠ” ì–´ì…ˆë¸”ë¦¬ë¡œ êµ¬ì„±ëœ í•¨ìˆ˜ê°€ ë˜ê³  ìˆ«ìëŠ” ë ˆì§€ìŠ¤í„°ì— í• ë‹¹ë  ê°’ë“¤ì´ ëœë‹¤. í•¨ìˆ˜ëŠ” í•¨ìˆ˜ ë¼ë²¨ë¡œ í‘œê¸°í•˜ì—¬ CPU ëª…ë ¹ ì²˜ë¦¬ê¸°ê°€ Jump í•  ìˆ˜ ìˆë„ë¡ í•˜ê³  ê° ìˆ«ìëŠ” ë¦¬í„°ëŸ´ì´ ëœë‹¤.</p><p>ì–´ì…ˆë¸”ë¦¬ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ì€ í˜•ì‹ìœ¼ë¡œ ì‹œì‘í•˜ê³  ì‹œìŠ¤í…œ ì½œì„ í†µí•´ ì¢…ë£Œëœë‹¤. (ì˜ˆì‹œëŠ” ìš”ì¦˜ macOS ê¸°ì¤€)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span>  <span style=color:#a6e22e>.global</span> <span style=color:#66d9ef>_main_</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>.text</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// í”„ë¡œê·¸ë¨ ì½”ë“œ...
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span>  <span style=color:#75715e>// í”„ë¡œê·¸ë¨ ì½”ë“œ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>MOV</span> <span style=color:#66d9ef>RDI</span>, <span style=color:#66d9ef>RAX</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>MOV</span> <span style=color:#66d9ef>RAX</span>, <span style=color:#ae81ff>0x2000001</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>SYSCALL</span>
</span></span></code></pre></div><p>ìš°ë¦¬ì˜ ìƒ˜í”Œ AST ëŠ” ë‘ ë²ˆì˜ <code>ADD</code> ì—°ì‚°ì„ í•˜ê²Œ ë  ì˜ˆì •ì´ê³  ì´ í•¨ìˆ˜ëŠ” <code>plus:</code> ë¼ëŠ” ë¼ë²¨ì„ ë‹¬ê³  ì¬ì‚¬ìš©í•  ê²ƒì´ë‹¤.</p><p>ì–´ì…ˆë¸”ë¦¬ ìˆ˜ì¤€ì—ì„œ í•¨ìˆ˜ í˜¸ì¶œ ê¸°ëŠ¥ì€ ì•„ë˜ì™€ ê°™ì€ í˜•ì‹ìœ¼ë¡œ êµ¬ì„±ë  ìˆ˜ ìˆë‹¤.</p><ol><li>ì—°ì‚°ì— ì‚¬ìš©ë  ì¸ìë¥¼ ë ˆì§€ìŠ¤í„°ì— ì €ì¥í•˜ê¸° ìœ„í•´ ë ˆì§€ìŠ¤í„°ì˜ ì´ì „ ê°’ì„ ì €ì¥ â†’ ê° ë ˆì§€ìŠ¤í„°ë¥¼ ìŠ¤íƒì— ì €ì¥ â†’ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜ ì¸ìì— ê°¯ìˆ˜ ë§Œí¼ë§Œ ìŠ¤íƒì— ì˜¬ë¦¬ë©´ ëœë‹¤.</li><li>ìš°ë¦¬ ìˆ˜ì¤€ì—ì„œ, ìµœëŒ€ 3ê°œê¹Œì§€ ì‚¬ìš© ê°€ëŠ¥í•œ ì¸ìë“¤ì„ ë ˆì§€ìŠ¤í„°ì— ì €ì¥ (ìˆœì„œëŒ€ë¡œ)</li><li>í•¨ìˆ˜ í˜¸ì¶œ â†’ ë”í•˜ê¸° ê¸°ëŠ¥ì„ í•˜ëŠ” í”„ë¡œì‹œì ¸ë¡œ ì´ë™ â†’ ì½”ë“œ ì‹¤í–‰ í›„ RET ëª…ë ¹ìœ¼ë¡œ ë³µê·€</li><li>ìŠ¤íƒì— ì €ì¥ëœ ë ˆì§€ìŠ¤í„° ê°’ì„ ë³µì› (ì €ì¥í•œ ì—­ìˆœìœ¼ë¡œ)</li><li>ê²°ê³¼ ê°’ì´ ì €ì¥ëœ ë ˆì§€ìŠ¤í„°ì—ì„œ ê°’ì„ í™•ì¸</li></ol><p>Phil ì˜ ì½”ë“œë¥¼ ì°¸ê³ ë¡œ ì¢€ ë” ì§„í–‰í•´ ë³´ì.</p><p>íŒŒë¼ë¯¸í„°ë¥¼ ìœ„í•œ 3ê°œì˜ ë ˆì§€ìŠ¤í„°ë¥¼ ì¤€ë¹„í•˜ê³ , ì–´ì…ˆë¸”ë¦¬ ë‚´ì¥ í•¨ìˆ˜ë¥¼ ê°ì‹¼ plus í•¨ìˆ˜ ë¼ë²¨ë„ ì¤€ë¹„í•´ ë‘ì—ˆë‹¤.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>OpCode</span> {
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;+&#39;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;+&#39;</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>Register</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>RDI</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;RDI&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>RSI</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;RSI&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>RDX</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;RDX&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>RAX</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;RAX&#39;</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ArgRegisters</span>: <span style=color:#66d9ef>Register</span>[] <span style=color:#f92672>=</span> [<span style=color:#a6e22e>Register</span>.<span style=color:#a6e22e>RDI</span>, <span style=color:#a6e22e>Register</span>.<span style=color:#a6e22e>RSI</span>, <span style=color:#a6e22e>Register</span>.<span style=color:#a6e22e>RDX</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>BuiltinFunctions</span>: <span style=color:#66d9ef>Record</span>&lt;<span style=color:#f92672>OpCode</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>string</span>&gt; <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;+&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;plus&#39;</span>,
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>í•¨ìˆ˜ í˜¸ì¶œ ìƒì„±í•˜ê¸° ìœ„í•œ compileFnCall í•¨ìˆ˜ë¥¼ ì‘ì„±í•´ ë³´ì. ìœ„ì—ì„œ ì•ˆë‚´í•œ pseudo ì½”ë“œë¥¼ ì˜®ê¸°ë©´ ëœë‹¤.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>compileFnCall</span>(<span style=color:#a6e22e>functionLabel</span>: <span style=color:#66d9ef>OpCode</span>, <span style=color:#a6e22e>args</span>: <span style=color:#66d9ef>Literal</span>[], <span style=color:#a6e22e>destination?</span>: <span style=color:#66d9ef>string</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>dump</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>dump</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>args</span>.<span style=color:#a6e22e>reduce</span>((<span style=color:#a6e22e>acc</span>, <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>index</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>acc</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>emit</span>(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>`PUSH </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>ArgRegisters</span>[<span style=color:#a6e22e>index</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>  }, <span style=color:#e6db74>&#39;&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>dump</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>args</span>.<span style=color:#a6e22e>reduce</span>((<span style=color:#a6e22e>acc</span>, <span style=color:#a6e22e>arg</span>, <span style=color:#a6e22e>index</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>acc</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>compileArgument</span>(<span style=color:#a6e22e>arg</span>, <span style=color:#a6e22e>ArgRegisters</span>[<span style=color:#a6e22e>index</span>]);
</span></span><span style=display:flex><span>  }, <span style=color:#e6db74>&#39;&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>dump</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>emit</span>(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>`CALL </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>BuiltinFunctions</span>[<span style=color:#a6e22e>functionLabel</span>] <span style=color:#f92672>||</span> <span style=color:#a6e22e>functionLabel</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>dump</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>args</span>.<span style=color:#a6e22e>reduceRight</span>((<span style=color:#a6e22e>acc</span>, <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>index</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>acc</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>emit</span>(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>`POP </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>ArgRegisters</span>[<span style=color:#a6e22e>index</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>  }, <span style=color:#e6db74>&#39;&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>destination</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>dump</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>emit</span>(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>`MOV </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>destination</span><span style=color:#e6db74>}</span><span style=color:#e6db74>, </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>Register</span>.<span style=color:#a6e22e>RDX</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>dump</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ìŠ¤íƒì— ì˜¬ë¦° ê¸°ì¡´ ë ˆì§€ìŠ¤í„° ê°’ë“¤ì€ ì—­ìˆœìœ¼ë¡œ ë³µì›í•˜ê¸° ìœ„í•´ reduceRight ë¥¼ ì‚¬ìš©í–ˆë‹¤.</p><p>ë‹¤ì‹œ í•œ ë²ˆ ìš°ë¦¬ì˜ AST ë¥¼ ë³´ì.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>[<span style=color:#e6db74>&#39;+&#39;</span>, <span style=color:#ae81ff>1</span>, [<span style=color:#e6db74>&#39;+&#39;</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>]]
</span></span></code></pre></div><p>ì¸ì ë³´ê´€ìš©ìœ¼ë¡œ ì‚¬ìš©í•  ë ˆì§€ìŠ¤í„°ë¥¼ ìŠ¤íƒì— ì˜¬ë ¤ ë‘ì—ˆë‹¤ë©´ AST ì˜ ì²« ë²ˆì§¸ ì¸ìë¥¼ OpCode ë¡œ í• ë‹¹í•˜ê³  ì´ì–´ì§€ëŠ” ì¸ìë¥¼ OpCode ì˜ ì¸ìê°€ ë  ë¦¬í„°ëŸ´ë¡œ ê°„ì£¼í•˜ì—¬ ë ˆì§€ìŠ¤í„°ì— ì˜¬ë ¤ë‘ì–´ì•¼ í•œë‹¤.</p><p>ì´ ê³¼ì •ì—ì„œ ì´ì–´ì§€ëŠ” ì¸ìê°€ ë°°ì—´ì¸ ê²½ìš°ëŠ” ë˜ ë‹¤ë¥¸ í•¨ìˆ˜ í˜¸ì¶œì´ ì˜ˆìƒë˜ê¸° ë•Œë¬¸ì— ë˜ ë‹¤ì‹œ OpCode ê°€ í˜¸ì¶œë˜ëŠ” ì¬ê·€ í•¨ìˆ˜ êµ¬ì„±ì„ ê°€ì§€ê²Œ ëœë‹¤.</p><p>ê·¸ë˜ì„œ ì¸ìë¥¼ compile í•˜ëŠ” í•¨ìˆ˜ëŠ” ì¸ìê°€ ë°°ì—´ì¼ ê²½ìš°ë¥¼ êµ¬ë¶„í•˜ì—¬ ì–´ìƒ˜ë¸”ë¦¬ ì½”ë“œë¥¼ emit í•˜ë„ë¡ í•˜ì.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>compileArgument</span>(<span style=color:#a6e22e>arg</span>: <span style=color:#66d9ef>Literal</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Literal</span>[], <span style=color:#a6e22e>destination</span>: <span style=color:#66d9ef>string</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (Array.<span style=color:#a6e22e>isArray</span>(<span style=color:#a6e22e>arg</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>opcode</span>, ...<span style=color:#a6e22e>rest</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>arg</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>compileFnCall</span>(<span style=color:#a6e22e>opcode</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>OpCode</span>, <span style=color:#a6e22e>rest</span>, <span style=color:#a6e22e>destination</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>emit</span>(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>`MOV </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>destination</span><span style=color:#e6db74>}</span><span style=color:#e6db74>, </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>arg</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ë°°ì—´ì´ ì•„ë‹Œ ì¼ë°˜ ë¦¬í„°ëŸ´ì´ë¼ë©´ ëŒ€ìƒ ë ˆì§€ìŠ¤í„°ì— ê°’ì„ ì§€ì •í•˜ëŠ” ê²ƒìœ¼ë¡œ ì¶©ë¶„í•˜ë‹¤.</p><p>ì´ì œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì¶”ê°€í•˜ê³  AST ë¥¼ ë°›ì•„ ì–´ì…ˆë¸”ë¦¬ë¡œ ì»´íŒŒì¼í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ì.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#a6e22e>describe</span>(<span style=color:#e6db74>&#39;Emit compiled code for arguments with destication&#39;</span>, () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>it</span>(<span style=color:#e6db74>&#39;should return single move statement&#39;</span>, () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>expected</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;\tMOV RDI, 1\n&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>compileArgument</span>(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#39;RDI&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>result</span>).<span style=color:#a6e22e>toEqual</span>(<span style=color:#a6e22e>expected</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>it</span>(<span style=color:#e6db74>&#39;should call compileCall function when got array of arguments&#39;</span>, () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>expected</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`</span><span style=color:#960050;background-color:#1e0010>\</span><span style=color:#e6db74>tPUSH RDI
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      // ...`</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>compileArgument</span>([<span style=color:#e6db74>&#39;+&#39;</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>], <span style=color:#e6db74>&#39;RSI&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>result</span>).<span style=color:#a6e22e>toEqual</span>(<span style=color:#a6e22e>expected</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>describe</span>(<span style=color:#e6db74>&#39;Emit compiled code for function call with opcode and arguments&#39;</span>, () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>it</span>(<span style=color:#e6db74>&#39;should return basic assembly code&#39;</span>, () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>expected</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`</span><span style=color:#960050;background-color:#1e0010>\</span><span style=color:#e6db74>tPUSH RDI 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      // ...`</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>compileFnCall</span>(<span style=color:#e6db74>&#39;+&#39;</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>OpCode</span>, [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>result</span>).<span style=color:#a6e22e>toEqual</span>(<span style=color:#a6e22e>expected</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>ì´ì œ ì–´ì…ˆë¸”ë¦¬ ë³¸ë¬¸ì„ ì™„ì„±í•´ ë³´ì. ë¨¼ì € prefix, postfix ìš© í•¨ìˆ˜ë¥¼ ì¶”ê°€í•˜ì. prefix ìª½ì— plus ë¼ë²¨ì„ ê°€ì§„ ADD í•¨ìˆ˜ë¥¼ ì‘ì„±í•´ ë‘ì—ˆë‹¤.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>emitPrefix() {</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>emit</span>(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#39;.global _main_&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>emit</span>(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#39;.text&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>emit</span>(<span style=color:#ae81ff>0</span>, <span style=color:#e6db74>&#39;plus:&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>emit</span>(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#39;ADD RDI, RSI&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>emit</span>(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#39;MOV RAX, RDI&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>emit</span>(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#39;RET&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>emit</span>(<span style=color:#ae81ff>0</span>, <span style=color:#e6db74>&#39;_main_:&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>emitPostfix() {</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>emit</span>(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#39;MOV RDI, RAX&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Set exit arg in macOS
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>emit</span>(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#39;MOV RAX, 0x2000001&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Set syscall number
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>emit</span>(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#39;SYSCALL&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ì´ ëª¨ë“  ì‘ì—…ì„ ì™„ì„±ì‹œí‚¬ compile í•¨ìˆ˜ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>compile</span>(<span style=color:#a6e22e>ast</span>: <span style=color:#66d9ef>Literal</span>[]) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>opcode</span>, ...<span style=color:#a6e22e>rest</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>ast</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>emitPrefix</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>compileFnCall</span>(<span style=color:#a6e22e>opcode</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>OpCode</span>, <span style=color:#a6e22e>rest</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>emitPostfix</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><p>ê° emit í•¨ìˆ˜ê°€ ë°˜í™˜í•˜ëŠ” ê°’ì„ ëª¨ì•„ì„œ ì²˜ë¦¬í•˜ëŠ” êµ¬ë¬¸ì€ ìƒëµë˜ì—ˆìœ¼ë‹ˆ ì €ì¥ì†Œì˜ ì†ŒìŠ¤ì½”ë“œë¥¼ ì°¸ê³ ;
<a href=https://github.com/soomtong/simple-lisp-compiler>https://github.com/soomtong/simple-lisp-compiler</a></p></blockquote><p>ì‚¬ìš©ëœ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‚´í´ ë³´ì.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#a6e22e>describe</span>(<span style=color:#e6db74>&#39;Emit basic AST into assembly code&#39;</span>, () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>it</span>(<span style=color:#e6db74>&#39;should emit a assembly code!&#39;</span>, () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>expected</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`// skipped whitespace
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  .global _main_
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  .text
</span></span></span><span style=display:flex><span><span style=color:#e6db74>plus:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ADD RDI, RSI
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  MOV RAX, RDI
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  RET
</span></span></span><span style=display:flex><span><span style=color:#e6db74>_main_:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  PUSH RDI
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  // ...
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  MOV RAX, 0x2000001
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  SYSCALL
</span></span></span><span style=display:flex><span><span style=color:#e6db74>`</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>compile</span>([<span style=color:#e6db74>&#39;+&#39;</span>, <span style=color:#ae81ff>1</span>, [<span style=color:#e6db74>&#39;+&#39;</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>]]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>result</span>).<span style=color:#a6e22e>toEqual</span>(<span style=color:#a6e22e>expected</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>ìë™ìœ¼ë¡œ ìŠ¤íƒì´ ê´€ë¦¬ë˜ëŠ” ê²ƒì´ ì´í•´ë˜ë©´ ë‹¤ìŒ íŒŒíŠ¸ë¡œ ì´ë™í•´ ë³´ì.</p></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>Â© 2023 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://faultnote.github.io/assets/main.js></script>
<script src=https://faultnote.github.io/assets/prism.js></script>
<script src=https://faultnote.github.io/assets/languageSelector.js></script></div></body></html>