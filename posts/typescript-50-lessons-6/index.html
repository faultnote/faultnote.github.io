<!doctype html><html lang=ko><head><title>TypeScript 50 Lessons Part 6 :: FaultNote</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="스매싱매거진의 타입스크립트 50 레슨 정리 6편"><meta name=keywords content="typescript,Stefan Baumgartner"><meta name=robots content="noodp"><link rel=canonical href=https://faultnote.github.io/posts/typescript-50-lessons-6/><script async src="https://www.googletagmanager.com/gtag/js?id=G-6J40Z181KC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6J40Z181KC")}</script><link rel=stylesheet href=https://faultnote.github.io/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css><link rel=stylesheet href=https://faultnote.github.io/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css><link rel=stylesheet href=https://faultnote.github.io/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css><link rel=stylesheet href=https://faultnote.github.io/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css><link rel=stylesheet href=https://faultnote.github.io/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=https://faultnote.github.io/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css><link rel=stylesheet href=https://faultnote.github.io/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css><link rel=stylesheet href=https://faultnote.github.io/css/menu.min.6a067853fcfe9d726ce02f96db38608eb850d4cb16a27d1395b74c23205aff9e.css><link rel=stylesheet href=https://faultnote.github.io/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css><link rel=stylesheet href=https://faultnote.github.io/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css><link rel=stylesheet href=https://faultnote.github.io/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css><link rel=stylesheet href=https://faultnote.github.io/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css><link rel=stylesheet href=https://faultnote.github.io/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel="shortcut icon" href=https://faultnote.github.io/favicon.png><link rel=apple-touch-icon href=https://faultnote.github.io/apple-touch-icon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="ko"><meta property="og:type" content="article"><meta property="og:title" content="TypeScript 50 Lessons Part 6"><meta property="og:description" content="스매싱매거진의 타입스크립트 50 레슨 정리 6편"><meta property="og:url" content="https://faultnote.github.io/posts/typescript-50-lessons-6/"><meta property="og:site_name" content="FaultNote"><meta property="og:image" content="https://faultnote.github.io/posts/images/cover-typescript-50-lessons.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2022-08-13 20:00:00 +0900 +0900"></head><body><div class=container><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>FaultNote</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/about>소개</a></li><li><a href=/series>연재</a></li><li><a href=/blog>블로그</a></li><hr><li><a href=https://faultnote.github.io/>한국어</a></li><li><a href=https://faultnote.github.io/en/>English</a></li></ul></li></ul><ul class="menu menu--desktop menu--language-selector"><li class=menu__trigger>한국어&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=https://faultnote.github.io/>한국어</a></li><li><a href=https://faultnote.github.io/en/>English</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/about>소개</a></li><li><a href=/series>연재</a></li><li><a href=/blog>블로그</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://faultnote.github.io/posts/typescript-50-lessons-6/>TypeScript 50 Lessons Part 6</a></h1><div class=post-meta><time class=post-date>2022-08-13</time><span class=post-author>soomtong</span><span class=post-reading-time>10 min read (4592 words)</span></div><span class=post-tags>#<a href=https://faultnote.github.io/tags/typescript/>typescript</a>&nbsp;
#<a href=https://faultnote.github.io/tags/javascript/>javascript</a>&nbsp;
</span><img src=https://faultnote.github.io/posts/images/cover-typescript-50-lessons.png class=post-cover alt="TypeScript 50 Lessons Part 6" title="Cover Image"><div class=post-content><div><div id=outline-container-headline-1 class=outline-2><h2 id=headline-1>타입스크립트 in 50 레슨</h2><div id=outline-text-headline-1 class=outline-text-2><p><a href=https://fettblog.eu/>스테판 바움가트너</a>가 스매싱 매거진에서 출판한 서적으로 타입스크립트 주요 주제들에 대해 잘 짚어주고 있다.</p><div id=outline-container-headline-2 class=outline-3><h3 id=headline-2>Lesson 36</h3><div id=outline-text-headline-2 class=outline-text-3><pre class=example>
조건부 타입
</pre><p>4장에서 union 과 intersection 을 통해 타입 공간을 확장하고 축소하는 방법과 임의의 데이터 구성에 대해 적당한 집합을 생성하는 법을 알아보았다. 5장에서는 generic 기법을 통해 타입을 공용화하고 데이터가 사용되는 시점에 함수와 클래스의 타입을 적용해 타입을 제약했다. 만약 타입이 애매하면 어떻게 할까? 제너릭하게 하나의 타입으로 묶지 못할 때는? 결과에 따라 타입을 선택해야 할 경우 등을 위해 조건부 타입이 필요하다.
if-else 를 사용하는 것과 같은 방식으로 타입에 조건을 사용하는 것이다. CD 나 LP 들을 파는 커머스 앱을 구성하면서 조건부 타입을 사용하는 방법을 알아보자.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Customer</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>customerId</span>: <span style=color:#66d9ef>number</span>
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>firstName</span>: <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>lastName</span>: <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Product</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>productId</span>: <span style=color:#66d9ef>number</span>
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>title</span>: <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>price</span>: <span style=color:#66d9ef>number</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Order</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>orderId</span>: <span style=color:#66d9ef>number</span>
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>customer</span>: <span style=color:#66d9ef>Customer</span>
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>products</span>: <span style=color:#66d9ef>Product</span>[]
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>date</span>: <span style=color:#66d9ef>Date</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div><p>전달되는 데이터에 따라 customer 인 경우 고객의 주문 목록을 제공하고, product 를 전달하는 경우 이 상품을 포함하는 주문서를 제공하고, orderId 를 전달하는 경우 해당 주문서를 제공하도록 fetchOrder 라는 함수를 구성해 보자.
함수 시그니처는 아래와 유사할 것이다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fetchOrder</span>(<span style=color:#a6e22e>customer</span>: <span style=color:#66d9ef>Customer</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Order</span>[]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fetchOrder</span>(<span style=color:#a6e22e>product</span>: <span style=color:#66d9ef>Product</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Order</span>[]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fetchOrder</span>(<span style=color:#a6e22e>orderId</span>: <span style=color:#66d9ef>number</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Order</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fetchOrder</span>(<span style=color:#a6e22e>param</span>: <span style=color:#66d9ef>any</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>any</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Implementation to follow
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}</span></span></code></pre></div></div><p>하지만 아래처럼 구성한다 하더라도 번잡해 보인다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fetchOrder</span>(<span style=color:#a6e22e>param</span>: <span style=color:#66d9ef>Customer</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Product</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>number</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>|</span> <span style=color:#a6e22e>Order</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Implementation to follow
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}</span></span></code></pre></div></div><p>조건부 타입 선언은 아래와 같은 형식을 가진다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Conditional</span>&lt;<span style=color:#f92672>T</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>T</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>U</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>A</span> : <span style=color:#66d9ef>B</span></span></span></code></pre></div></div><p>이전에 배운 extends 를 사용한다. 조건부 타입 정의는 3항 연산자 사용과 같다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchParams</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>number</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Customer</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Product</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchReturn</span>&lt;<span style=color:#f92672>T</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>T</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Customer</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> <span style=color:#a6e22e>T</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Product</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> <span style=color:#a6e22e>T</span> <span style=color:#66d9ef>extends</span> <span style=color:#66d9ef>number</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span> : <span style=color:#66d9ef>never</span></span></span></code></pre></div></div><p>이제 함수 선언을 다시 보자.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fetchOrder</span>&lt;<span style=color:#f92672>Param</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>FetchParams</span>&gt;(<span style=color:#a6e22e>param</span>: <span style=color:#66d9ef>Param</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>FetchReturn</span>&lt;<span style=color:#f92672>Param</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Well, the implementation
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}</span></span></code></pre></div></div><p>전달되는 타입에 대해 반환되는 타입도 강제된다.</p></div></div><div id=outline-container-headline-3 class=outline-3><h3 id=headline-3>Lesson 37</h3><div id=outline-text-headline-3 class=outline-text-3><pre class=example>
함수 오버로딩과 조건부 타입을 결합하기
</pre><p>조건부 타입은 옵셔널 인자에 대해도 동작한다. fetchOrder 를 비동기 함수로 변경하고 두 번째 인자에 콜백할 수 있는 옵셔널 함수를 추가해 보자.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Callback</span>&lt;<span style=color:#f92672>Res</span>&gt; <span style=color:#f92672>=</span> (<span style=color:#a6e22e>result</span>: <span style=color:#66d9ef>Res</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>void</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fetchOrder</span>&lt;<span style=color:#f92672>T</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>FetchParams</span>&gt;(<span style=color:#a6e22e>param</span>: <span style=color:#66d9ef>T</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>FetchReturn</span>&lt;<span style=color:#f92672>T</span>&gt;&gt;
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fetchOrder</span>&lt;<span style=color:#f92672>T</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>FetchParams</span>&gt;(<span style=color:#a6e22e>param</span>: <span style=color:#66d9ef>T</span>, <span style=color:#a6e22e>callback</span>: <span style=color:#66d9ef>Callback</span>&lt;<span style=color:#f92672>FetchReturn</span>&lt;<span style=color:#f92672>T</span>&gt;&gt;)<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fetchOrder</span>&lt;<span style=color:#f92672>T</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>FetchParams</span>&gt;(<span style=color:#a6e22e>param</span>: <span style=color:#66d9ef>T</span>, <span style=color:#a6e22e>callback?</span>: <span style=color:#66d9ef>Callback</span>&lt;<span style=color:#f92672>FetchReturn</span>&lt;<span style=color:#f92672>T</span>&gt;&gt;)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>FetchReturn</span>&lt;<span style=color:#f92672>T</span>&gt;&gt; <span style=color:#f92672>|</span> <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#39;url&#39;</span>).<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>res</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>json</span>())
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>callback</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>result</span> <span style=color:#f92672>=&gt;</span> { <span style=color:#a6e22e>callback</span>(<span style=color:#a6e22e>result</span>) })
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>data</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div><p>이제 저 복잡한 함수 선언을 정리해보자. 두 번째 인자가 선택적으로 제공되기 때문에 가변 인자를 사용할 수 있는 점을 활용해 보자.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fetchOrder</span>&lt;<span style=color:#f92672>P</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>FetchParams</span>&gt;(...<span style=color:#a6e22e>args</span><span style=color:#f92672>:</span> [<span style=color:#a6e22e>P</span>])<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>FetchReturn</span>&lt;<span style=color:#f92672>P</span>&gt;&gt;
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fetchOrder</span>&lt;<span style=color:#f92672>P</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>FetchParams</span>&gt;(...<span style=color:#a6e22e>args</span><span style=color:#f92672>:</span> [<span style=color:#a6e22e>P</span>, <span style=color:#a6e22e>Callback</span>&lt;<span style=color:#f92672>FetchReturn</span>&lt;<span style=color:#f92672>P</span>&gt;&gt;])<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span></span></span></code></pre></div></div><p>함수 인자의 타입을 정리해 보자. FetchParams 와 FetchCallback 을 FetchHead 로 묶어 본다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchCallback</span>&lt;<span style=color:#f92672>T</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>FetchParams</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>Callback</span>&lt;<span style=color:#f92672>FetchReturn</span>&lt;<span style=color:#f92672>T</span>&gt;&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>AsyncResult</span>&lt;<span style=color:#f92672>FetchHead</span>, <span style=color:#a6e22e>Param</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>FetchParams</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>FetchHead</span> <span style=color:#66d9ef>extends</span> [<span style=color:#a6e22e>Param</span>, <span style=color:#a6e22e>FetchCallback</span>&lt;<span style=color:#f92672>Param</span>&gt;]
</span></span><span style=display:flex><span>    <span style=color:#f92672>?</span> <span style=color:#66d9ef>void</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>FetchHead</span> <span style=color:#66d9ef>extends</span> [<span style=color:#a6e22e>Param</span>]
</span></span><span style=display:flex><span>    <span style=color:#f92672>?</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>FetchReturn</span>&lt;<span style=color:#f92672>Param</span>&gt;&gt; <span style=color:#f92672>:</span> <span style=color:#66d9ef>never</span></span></span></code></pre></div></div><p>정의된 타입을 활용하는 함수 선언은 이렇게 될 것이다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fetchOrder</span>&lt;<span style=color:#f92672>T</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>FetchParam</span>, <span style=color:#a6e22e>U</span>&gt;(...<span style=color:#a6e22e>args</span>: <span style=color:#66d9ef>U</span>) <span style=color:#f92672>:</span> <span style=color:#a6e22e>AsyncResult</span>&lt;<span style=color:#f92672>U</span>, <span style=color:#a6e22e>T</span>&gt;</span></span></code></pre></div></div><p>함수 인자의 길이를 판단하여 조건부 타입으로 반환하는 연산을 통해 함수의 인자 타입과 반환 타입을 단순하게 정리하였다.
이 과정은 가독성과 정확성을 기준으로 적용을 고려하면 된다. 이해하기 위운 함수 오버로드 버전도 나쁘지 않음을 기억하자.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// Version 1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fetchOrder</span>&lt;<span style=color:#f92672>Par</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>FetchParams</span>&gt;(<span style=color:#a6e22e>inp</span>: <span style=color:#66d9ef>Par</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>FetchReturn</span>&lt;<span style=color:#f92672>Par</span>&gt;&gt;
</span></span><span style=display:flex><span><span style=color:#75715e>// Version 2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fetchOrder</span>&lt;<span style=color:#f92672>Par</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>FetchParams</span>&gt;(<span style=color:#a6e22e>inp</span>: <span style=color:#66d9ef>Par</span>, <span style=color:#a6e22e>fun</span>: <span style=color:#66d9ef>Callback</span>&lt;<span style=color:#f92672>FetchReturn</span>&lt;<span style=color:#f92672>Par</span>&gt;&gt;)<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// The implementation!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fetchOrder</span>&lt;<span style=color:#f92672>Par</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>FetchParams</span>&gt;(<span style=color:#a6e22e>inp</span>: <span style=color:#66d9ef>Par</span>, <span style=color:#a6e22e>fun?</span>: <span style=color:#66d9ef>Callback</span>&lt;<span style=color:#f92672>FetchReturn</span>&lt;<span style=color:#f92672>Par</span>&gt;&gt;)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>FetchReturn</span>&lt;<span style=color:#f92672>Par</span>&gt;&gt; <span style=color:#f92672>|</span> <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Fetch the result
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>res</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>`/backend?inp=</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>inp</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>).<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>res</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>json</span>())
</span></span><span style=display:flex><span>    <span style=color:#75715e>// If there’s a callback, call it
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>fun</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>result</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fun</span>(<span style=color:#a6e22e>result</span>)
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Otherwise return the result promise
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>res</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div><div id=outline-container-headline-4 class=outline-3><h3 id=headline-4>Lesson 38</h3><div id=outline-text-headline-4 class=outline-text-3><pre class=example>
체크된 타입이 네이키드 타입의 매개변수인 조건 타입을 분배 조건 타입이라고 한다.
</pre><p>지난 시간에 인자를 가지고 조건에 맞는 타입을 반환하는 함수처럼 동작하는 제너릭 타입을 살펴 보았다. 조건부 타입을 더 들여다보기 전에 이전 예제로 사용한 조건부 타입을 한 번 더 보자.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchParams</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>number</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Customer</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Product</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchReturn</span>&lt;<span style=color:#f92672>Param</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>FetchParams</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>Param</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Customer</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> <span style=color:#a6e22e>Param</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Product</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> <span style=color:#a6e22e>Order</span></span></span></code></pre></div></div><p>FetchReturn 타입에 Customer 를 적용해 보자.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchByCustomer</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>FetchReturn</span>&lt;<span style=color:#f92672>Customer</span>&gt;
</span></span><span style=display:flex><span><span style=color:#75715e>// transalated
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchByCustomer</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Customer</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Customer</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> <span style=color:#a6e22e>Customer</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Product</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> <span style=color:#a6e22e>Order</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// finally
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchByCustomer</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Order</span>[]</span></span></code></pre></div></div><p>분산된 유니언 타입을 살펴 보자. 대부분의 경우 조건부 타입은 실행시기에 유니언 타입으로 배분된다. FetchReturn 은 Product 와 number 타입으로 생성된다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchByProductOrId</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>FetchReturn</span>&lt;<span style=color:#f92672>Product</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#a6e22e>number</span>&gt;</span></span></code></pre></div></div><p>FetchReturn 은 배분되는 조건부 타입이다. 뭔 말이냐면, 이는 제네릭 유형 매개변수의 각 구성요소가 동일한 조건부 유형으로 인스턴스화됨을 의미한다. 간단히 말해서, Union 유형의 조건부 유형은 조건부 유형의 Union 타입과 같다. 코드를 보자.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchByProductOrId</span> <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> (<span style=color:#a6e22e>Product</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Customer</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> <span style=color:#a6e22e>Product</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Product</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> <span style=color:#a6e22e>Order</span>)
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> (<span style=color:#66d9ef>number</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Customer</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> <span style=color:#66d9ef>number</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Product</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> <span style=color:#a6e22e>Order</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>// transalated
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchByProductOrId</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>|</span> <span style=color:#a6e22e>Order</span></span></span></code></pre></div></div><p>타입스크립트의 조건부 타입의 동작이 분산을 통해 동작한다는 것을 아는 것은 매우 중요하다.</p><ol><li>각각의 입력되는 타입이 하나의 출력 타입이 되는 것을 추적할 수 있다.</li><li>각각 다른 타입 입력은 다른 출력 타입을 가져야 한다.</li></ol><p>다양한 조건이 있더라도 반환되는 타입은 중복되고 불가능한 조합은 제거된다. 아래 코드의 출력 타입은 같다는 것이다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchByProductOrId</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>FetchReturn</span>&lt;<span style=color:#f92672>Product</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#a6e22e>Customer</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#a6e22e>number</span>&gt;
</span></span><span style=display:flex><span><span style=color:#75715e>// Equal to
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchByProductOrId</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>Product</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Customer</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> <span style=color:#a6e22e>Product</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Product</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> <span style=color:#a6e22e>Order</span>)
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> (<span style=color:#a6e22e>Customer</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Customer</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> <span style=color:#a6e22e>Customer</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Product</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> <span style=color:#a6e22e>Order</span>)
</span></span><span style=display:flex><span>    <span style=color:#f92672>|</span> (<span style=color:#66d9ef>number</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Customer</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> <span style=color:#66d9ef>number</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Product</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> <span style=color:#a6e22e>Order</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>// Equal to
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchByProductOrId</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>|</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>|</span> <span style=color:#a6e22e>Order</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Removed redundancies
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchByProductOrId</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>|</span> <span style=color:#a6e22e>Order</span></span></span></code></pre></div></div><p>분산 조건부 타입의 중요한 전제 조건은 연산에 사용되는 제너릭 타입의 파라미터가 네이키드 타입이어야 한다는 것이다. 네이키드 타입은 타입 파라미터가 현재 존재하고 다른 구성의 일부분이 아닌 타입을 말한다. 배열, 튜플, 함수형, 비동기 타입 등의 제너릭 타입이 아닌 타입이다.
제너릭 타입의 파라미터가 네이키드 타입이 아닌 경우는 사이드 이펙트가 발생할 수 있다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchReturn</span>&lt;<span style=color:#f92672>Param</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>FetchParams</span>&gt; <span style=color:#f92672>=</span> [<span style=color:#a6e22e>Param</span>] <span style=color:#66d9ef>extends</span> [<span style=color:#a6e22e>Customer</span>] <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> [<span style=color:#a6e22e>Param</span>] <span style=color:#66d9ef>extends</span> [<span style=color:#a6e22e>Product</span>] <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> <span style=color:#a6e22e>Order</span></span></span></code></pre></div></div><p>단일 타입이 연동될 때 조건부 타입은 예전처럼 동작할 것이다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchByCustomer</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>FetchReturn</span>&lt;<span style=color:#f92672>Customer</span>&gt;
</span></span><span style=display:flex><span><span style=color:#75715e>// This condition is still true!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchByCustomer</span> <span style=color:#f92672>=</span> [<span style=color:#a6e22e>Customer</span>] <span style=color:#66d9ef>extends</span> [<span style=color:#a6e22e>Customer</span>] <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> [<span style=color:#a6e22e>Customer</span>] <span style=color:#66d9ef>extends</span> [<span style=color:#a6e22e>Product</span>] <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> <span style=color:#a6e22e>Order</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Equal to
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchByCustomer</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Order</span>[]</span></span></code></pre></div></div><p>하지만 튜플 타입이 입력된다면 Customer 는 서브 타입으로 식별되고 분산되지 않게 된다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchByCustomerOrId</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>FetchReturn</span>&lt;<span style=color:#f92672>Customer</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#a6e22e>number</span>&gt;
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchByProductOrId</span> <span style=color:#f92672>=</span> [<span style=color:#a6e22e>Customer</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>number</span>] <span style=color:#66d9ef>extends</span> [<span style=color:#a6e22e>Customer</span>] <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> <span style=color:#75715e>// This is false!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                          [<span style=color:#a6e22e>Customer</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>number</span>] <span style=color:#66d9ef>extends</span> [<span style=color:#a6e22e>Product</span>] <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> <span style=color:#75715e>// This is obviously also false
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                          <span style=color:#a6e22e>Order</span> <span style=color:#75715e>// So we resolve to this
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Equal to
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchByProductOrId</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Order</span></span></span></code></pre></div></div><p>[Customer | number] 는 [Customer] 의 수퍼 타입이기 때문에 [Customer] 를 확장하지 못한다.
위 FetchReturn 을 안전하고 정확하게 만들기 위해 숫자의 서브 타입을 확인하는 다른 조건을 추가할 수 있다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchReturn</span>&lt;<span style=color:#f92672>Param</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>FetchParams</span>&gt; <span style=color:#f92672>=</span> [<span style=color:#a6e22e>Param</span>] <span style=color:#66d9ef>extends</span> [<span style=color:#a6e22e>Customer</span>]
</span></span><span style=display:flex><span>    <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> [<span style=color:#a6e22e>Param</span>] <span style=color:#66d9ef>extends</span> [<span style=color:#a6e22e>Product</span>]
</span></span><span style=display:flex><span>    <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> [<span style=color:#a6e22e>Param</span>] <span style=color:#66d9ef>extends</span> [<span style=color:#66d9ef>number</span>]
</span></span><span style=display:flex><span>    <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span> : <span style=color:#66d9ef>never</span></span></span></code></pre></div></div><p>이렇게 하면 단일 유형으로 입력하는 경우까지 올바른 반환 타입을 얻을 수 있다.</p></div></div><div id=outline-container-headline-5 class=outline-3><h3 id=headline-5>Lesson 39</h3><div id=outline-text-headline-5 class=outline-text-3><pre class=example>
Never 타입과 Extract
</pre><p>조건부 타입의 분산 프로퍼티는 never 와 결합할 때 유용한 필터 역할을 한다. CD 와 LP 를 골라 파는 웹서비스를 구현하는 과정에 적용해 본다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Medium</span> <span style=color:#f92672>=</span> { <span style=color:#a6e22e>id</span>: <span style=color:#66d9ef>number</span>; <span style=color:#a6e22e>title</span>: <span style=color:#66d9ef>string</span>; <span style=color:#a6e22e>artist</span>: <span style=color:#66d9ef>string</span> }
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>TrackInfo</span> <span style=color:#f92672>=</span> { <span style=color:#a6e22e>duration</span>: <span style=color:#66d9ef>number</span>; <span style=color:#a6e22e>tracks</span>: <span style=color:#66d9ef>number</span> }</span></span></code></pre></div></div><p>CD 와 LP 의 특성에 따라 Union 타입을 구성한다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>CD</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Medium</span> <span style=color:#f92672>&amp;</span> <span style=color:#a6e22e>TrackInfo</span> <span style=color:#f92672>&amp;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>kind</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;cd&#39;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>LP</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Medium</span> <span style=color:#f92672>&amp;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sides</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>a</span>: <span style=color:#66d9ef>TrackInfo</span>; <span style=color:#a6e22e>b</span>: <span style=color:#66d9ef>TrackInfo</span> }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>kind</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;lp&#39;</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div><p>모든 미디어에 적용할 수 있는 타입과 미디어에 대한 유니언 키를 정의하자.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>AllMedia</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>CD</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>LP</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>MediaTypes</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>AllMedia</span>[<span style=color:#e6db74>&#39;kind&#39;</span>]</span></span></code></pre></div></div><p>미디어 종류와 나머지 정보를 전달하여 createMedium 함수를 만들자.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>declare</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>createMedium</span>(<span style=color:#a6e22e>kind</span>: <span style=color:#66d9ef>MediaKinds</span>, <span style=color:#a6e22e>info</span> )<span style=color:#f92672>:</span> <span style=color:#a6e22e>AllMedia</span></span></span></code></pre></div></div><p>위와 같은 함수 원형을 구성할 수 있다. 여기에 제너릭을 추가해보자.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>declare</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>createMedium</span>&lt;<span style=color:#f92672>Kin</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>MediaKinds</span>&gt;(<span style=color:#a6e22e>kind</span>: <span style=color:#66d9ef>Kin</span>, <span style=color:#a6e22e>info</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>AllMedia</span></span></span></code></pre></div></div><p>이어서 AllMedia 의 타입을 좁혀 보자. Union 의 조건부 결과는 해당 조건의 합집합이다. 조건부 유형을 처리하는 과정에 CD 나 LP 가 아닌 경우 never 를 사용할 수 있다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>SelectBranch</span>&lt;<span style=color:#f92672>Brnch</span>, <span style=color:#a6e22e>Kin</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>Brnch</span> <span style=color:#66d9ef>extends</span> { <span style=color:#a6e22e>kind</span>: <span style=color:#66d9ef>Kin</span> } <span style=color:#f92672>?</span> <span style=color:#a6e22e>Brnch</span> : <span style=color:#66d9ef>never</span></span></span></code></pre></div></div><p>Brnch 값을 통해 CD, LP 타입을 구분할 수 있고 그 어떤 것도 아닌 것을 알아 판단할 수 있게 된다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>SelectCD</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>SelectBranch</span>&lt;<span style=color:#f92672>AllMedia</span>, <span style=color:#e6db74>&#39;cd&#39;</span>&gt;
</span></span><span style=display:flex><span><span style=color:#75715e>// This equals
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>SelectCD</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>SelectBranch</span>&lt;<span style=color:#f92672>CD</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#a6e22e>LP</span>, <span style=color:#e6db74>&#39;cd&#39;</span>&gt;
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>SelectCD</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>SelectBranch</span>&lt;<span style=color:#f92672>CD</span>, <span style=color:#e6db74>&#39;cd&#39;</span>&gt; <span style=color:#f92672>|</span> <span style=color:#a6e22e>SelectBranch</span>&lt;<span style=color:#f92672>LP</span>, <span style=color:#e6db74>&#39;cd&#39;</span>&gt;
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>SelectCD</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>CD</span> <span style=color:#66d9ef>extends</span> { <span style=color:#a6e22e>kind</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;cd&#39;</span> } <span style=color:#f92672>?</span> <span style=color:#a6e22e>CD</span> : <span style=color:#66d9ef>never</span>) <span style=color:#f92672>|</span> (<span style=color:#a6e22e>LP</span> <span style=color:#66d9ef>extends</span> { <span style=color:#a6e22e>kind</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;cd&#39;</span> } <span style=color:#f92672>?</span> <span style=color:#a6e22e>LP</span> : <span style=color:#66d9ef>never</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>// Evaluate!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>SelectCD</span> <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// This is true! Awesome! Let’s return CD
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    (<span style=color:#a6e22e>CD</span> <span style=color:#66d9ef>extends</span> { <span style=color:#a6e22e>kind</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;cd&#39;</span> } <span style=color:#f92672>?</span> <span style=color:#a6e22e>CD</span> : <span style=color:#66d9ef>never</span>) <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// This is false. let’s return never
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    (<span style=color:#a6e22e>LP</span> <span style=color:#66d9ef>extends</span> { <span style=color:#a6e22e>kind</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;cd&#39;</span> } <span style=color:#f92672>?</span> <span style=color:#a6e22e>LP</span> : <span style=color:#66d9ef>never</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>// Equal to
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>SelectCD</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>CD</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>never</span></span></span></code></pre></div></div><p>결국 CD | never 의 유니언 타입을 얻게 되는데 결국 SelectCD 는 CD 를 얻게 된다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>declare</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>createMedium</span>&lt;<span style=color:#f92672>Kin</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>MediaKinds</span>&gt;(<span style=color:#a6e22e>kind</span>: <span style=color:#66d9ef>Kin</span>, <span style=color:#a6e22e>info</span> )<span style=color:#f92672>:</span> <span style=color:#a6e22e>SelectBranch</span>&lt;<span style=color:#f92672>AllMedia</span>, <span style=color:#a6e22e>Kin</span>&gt;</span></span></code></pre></div></div><p>그래서 함수 원형은 위와 같이 작성할 수 있다. 타입 연산만으로 입력과 출력에 대해 튜링 컴플리트할 수 있게 된다.
이렇게 never 를 사용하는 유틸리티 함수 타입에 Extract 가 제공된다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Extract</span>&lt;<span style=color:#f92672>A</span>, <span style=color:#a6e22e>B</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>A</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>B</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>A</span> : <span style=color:#66d9ef>never</span></span></span></code></pre></div></div><p>Extract 를 사용해 LP 타입을 구성할 수 있다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>SelectLP</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Extract</span>&lt;<span style=color:#f92672>AllMedia</span>, { <span style=color:#a6e22e>kind</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#39;lp&#39;</span> }&gt;</span></span></code></pre></div></div></div></div><div id=outline-container-headline-6 class=outline-3><h3 id=headline-6>Lesson 40</h3><div id=outline-text-headline-6 class=outline-text-3><pre class=example>
합성 보조 타입
</pre><p>이전에 CD 와 LP 타입을 정의하였으니 이것만으로 createMedium 의 info 인수 타입을 정의할 때 재사용하자.
우선 key 가 되는 식별자를 제거해 보자. 예를 들면, CD 인지 LP 인지 구별할 수 있으니 kind 나 자동 생성되는 id 는 필요없다.
이를 위해 Remove 합성 보조 타입을 살펴 보자.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>CDKeys</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>keyof</span> <span style=color:#a6e22e>CD</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Equal to
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>CDKeys</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;id&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;description&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;title&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;kind&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;tracks&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;duration&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Now for the keys we actually want
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>CDInfoKeys</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Remove</span>&lt;<span style=color:#f92672>CDKeys</span>, <span style=color:#a6e22e>Removable</span>&gt;
</span></span><span style=display:flex><span><span style=color:#75715e>// Equal to
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>CDInfoKeys</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Remove</span><span style=color:#f92672>&lt;</span><span style=color:#e6db74>&#39;id&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;description&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;title&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;kind&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;tracks&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;duration&#39;</span>, <span style=color:#e6db74>&#39;id&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;kind&#39;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// A conditional of a union is a union of conditionals
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>CDInfoKeys</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Remove</span><span style=color:#f92672>&lt;</span><span style=color:#e6db74>&#39;id&#39;</span>, <span style=color:#e6db74>&#39;id&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;kind&#39;</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Remove</span><span style=color:#f92672>&lt;</span><span style=color:#e6db74>&#39;description&#39;</span>, <span style=color:#e6db74>&#39;id&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;kind&#39;</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Remove</span><span style=color:#f92672>&lt;</span><span style=color:#e6db74>&#39;title&#39;</span>, <span style=color:#e6db74>&#39;id&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;kind&#39;</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>Remove</span><span style=color:#f92672>&lt;</span><span style=color:#e6db74>&#39;kind&#39;</span>, <span style=color:#e6db74>&#39;id&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;kind&#39;</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Remove</span><span style=color:#f92672>&lt;</span><span style=color:#e6db74>&#39;tracks&#39;</span>, <span style=color:#e6db74>&#39;id&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;kind&#39;</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Remove</span><span style=color:#f92672>&lt;</span><span style=color:#e6db74>&#39;duration&#39;</span>, <span style=color:#e6db74>&#39;id&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;kind&#39;</span><span style=color:#f92672>&gt;</span></span></span></code></pre></div></div><p>Remove 는 아래와 같이 정의된다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Remove</span>&lt;<span style=color:#f92672>A</span>, <span style=color:#a6e22e>B</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>A</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>B</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>never</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>A</span></span></span></code></pre></div></div><p>각 보조 타입을 대치해 보자.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>CDInfoKeys</span> <span style=color:#f92672>=</span> (<span style=color:#e6db74>&#39;id&#39;</span> <span style=color:#66d9ef>extends</span> <span style=color:#e6db74>&#39;id&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;kind&#39;</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>never</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;id&#39;</span>) <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>    (<span style=color:#e6db74>&#39;description&#39;</span> <span style=color:#66d9ef>extends</span> <span style=color:#e6db74>&#39;id&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;kind&#39;</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>never</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;description&#39;</span>) <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>    (<span style=color:#e6db74>&#39;title&#39;</span> <span style=color:#66d9ef>extends</span> <span style=color:#e6db74>&#39;id&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;kind&#39;</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>never</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;title&#39;</span>) <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>    (<span style=color:#e6db74>&#39;kind&#39;</span> <span style=color:#66d9ef>extends</span> <span style=color:#e6db74>&#39;id&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;kind&#39;</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>never</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;kind&#39;</span>) <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>    (<span style=color:#e6db74>&#39;tracks&#39;</span> <span style=color:#66d9ef>extends</span> <span style=color:#e6db74>&#39;id&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;kind&#39;</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>never</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;tracks&#39;</span>) <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>    (<span style=color:#e6db74>&#39;duration&#39;</span> <span style=color:#66d9ef>extends</span> <span style=color:#e6db74>&#39;id&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;kind&#39;</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>never</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;duration&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>// Evaluate
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>CDInfoKeys</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>never</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;description&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;title&#39;</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>never</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;tracks&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;duration&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Remove impossible types from the union
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>CDInfoKeys</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;description&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;title&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;tracks&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;duration&#39;</span></span></span></code></pre></div></div><p>이 Remove 타입은 Exclude 라는 내장 타입으로 선언되어 있다.
이제 key 를 제외한 info 타입을 정의할 수 있다. 이전에 사용한 Pick 합성 타입을 사용하면 아래와 같다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>CDInfo</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Pick</span>&lt;<span style=color:#f92672>CD</span>, <span style=color:#a6e22e>Exclude</span>&lt;<span style=color:#f92672>keyof</span> <span style=color:#a6e22e>CD</span>, <span style=color:#e6db74>&#39;kind&#39;</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#e6db74>&#39;id&#39;</span>&gt;&gt;</span></span></code></pre></div></div><p>좀 복잡하기 때문에 Omit 이라는 보조 타입을 제공한다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>CDInfo</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Omit</span>&lt;<span style=color:#f92672>CD</span>, <span style=color:#e6db74>&#39;kind&#39;</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#e6db74>&#39;id&#39;</span>&gt;</span></span></code></pre></div></div><p>이전에 정의해 둔 RemovableKeys 를 사용해 정리해 보자.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>RemovableKeys</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;kind&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;id&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>GetInfo</span>&lt;<span style=color:#f92672>Med</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>Omit</span>&lt;<span style=color:#f92672>Med</span>, <span style=color:#a6e22e>RemovableKeys</span>&gt;
</span></span><span style=display:flex><span><span style=color:#66d9ef>declare</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>createMedium</span>&lt;<span style=color:#f92672>Kin</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>MediaKinds</span>&gt;(<span style=color:#a6e22e>kind</span>: <span style=color:#66d9ef>Kin</span>, <span style=color:#a6e22e>info</span>: <span style=color:#66d9ef>GetInfo</span>&lt;<span style=color:#f92672>SelectedBranch</span>&lt;<span style=color:#f92672>AllMedia</span>, <span style=color:#a6e22e>Kin</span>&gt;&gt; )<span style=color:#f92672>:</span> <span style=color:#a6e22e>SelectBranch</span>&lt;<span style=color:#f92672>AllMedia</span>, <span style=color:#a6e22e>Kin</span>&gt;</span></span></code></pre></div></div><p>기본 타입의 모델 데이터를 잘 구성하고 제너릭과 분산 조건부 타입을 통해 그 안의 타입을 재활용하는 것이 타입스크립트를 잘 활용하는 것 같다.</p></div></div><div id=outline-container-headline-7 class=outline-3><h3 id=headline-7>Lesson 41</h3><div id=outline-text-headline-7 class=outline-text-3><pre class=example>
함수 선언에서 파라미터 타입을 infer 하기
</pre><p>타입 관리 드는 비용을 적게할수록 타입스크립트는 효율적으로 동작한다. 지금까지 데이터를 모델링하고 행동을 기술하는 작업 방식을 깨끗하게 유지시키지는 과정이었다. 다른 타입에서 동적으로 타입을 생성하고 운용하여 타입 관리에 많은 시간을 보내지 않은 것이다.
하지만 개발이 진행되는 과정에는 계속 변한다. 지금까지 실습해 온 이커머스의 어드민 서비스를 가정하고 레슨을 시작하자.
새 유저를 생성하는 코드이다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>createUser</span>(<span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>role</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;admin&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;maintenace&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;shipping&#39;</span>, <span style=color:#a6e22e>isActive</span>: <span style=color:#66d9ef>boolean</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> { <span style=color:#a6e22e>userId</span>: <span style=color:#66d9ef>userId</span><span style=color:#f92672>++</span>, <span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>role</span>, <span style=color:#a6e22e>isActive</span>, <span style=color:#a6e22e>createdAt</span>: <span style=color:#66d9ef>new</span> Date() }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div><p>두 개의 속성은 자동 생성되고 나머지는 인수로 받는다. 타입을 적용해 좀 더 단단하게 만들 것이다.
역할은 admin, maintenance 와 shopoing 으로 나눈다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>createUser</span>(<span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>role</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;admin&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;maintenace&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;shipping&#39;</span>, <span style=color:#a6e22e>isActive</span>: <span style=color:#66d9ef>boolean</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}</span></span></code></pre></div></div><p>더 타입 안전한 환경으로 개선하자. 그 전에 생성되는 user 의 타입을 추론해 보자.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>user</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createUser</span>(<span style=color:#e6db74>&#39;Stefan&#39;</span>, <span style=color:#e6db74>&#39;shipping&#39;</span>, <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>User</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>user</span></span></span></code></pre></div></div><p>이렇게 User 타입을 추론할 수 있지만 비용도 높고 위험하다. 함수의 반환 값이 아니라 함수 선언에서 반환 타입을 추론할 수 있게 해보자.
우선 함수 인지 확인하고 createUser 의 함수 타입을 생성한다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>GetReturn</span>&lt;<span style=color:#f92672>Fun</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>Fun</span> <span style=color:#66d9ef>extends</span> (...<span style=color:#a6e22e>args</span>: <span style=color:#66d9ef>any</span>[]) <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>any</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>Fun</span> : <span style=color:#66d9ef>never</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// get this
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Fun</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>GetReturn</span>&lt;<span style=color:#f92672>typeof</span> <span style=color:#a6e22e>createUser</span>&gt;</span></span></code></pre></div></div><p>이제 infer 키워드를 통해 extends 로 확장된 함수 타입에 대해 제너릭 타입을 구성할 수 있다. 함수의 반환 타입 any 를 제너릭하게 처리하게 된다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>GetReturn</span>&lt;<span style=color:#f92672>Fun</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>Fun</span> <span style=color:#66d9ef>extends</span> (...<span style=color:#a6e22e>args</span>: <span style=color:#66d9ef>any</span>[]) <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>infer</span> <span style=color:#a6e22e>R</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>R</span> : <span style=color:#66d9ef>never</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// get this
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>User</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>GetReturn</span>&lt;<span style=color:#f92672>typeof</span> <span style=color:#a6e22e>createUser</span>&gt;</span></span></code></pre></div></div><p>이런 보조 타입은 데이터베이스에서 데이터를 저장하고 불러올 때나 스키마를 통해 새 객체를 만드는 일을 할 때 자주 필요하다. infer 키워드를 통해 타입 제약을 견고하게 할 수 있다.
promise 를 통해 조회되는 값에 대해 타입을 정의해 보면 이렇다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Unpack</span>&lt;<span style=color:#f92672>T</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>T</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>infer</span> <span style=color:#a6e22e>Res</span>&gt; <span style=color:#f92672>?</span> <span style=color:#a6e22e>Res</span> : <span style=color:#66d9ef>never</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>A1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Unpack</span>&lt;<span style=color:#f92672>Promise</span>&lt;<span style=color:#f92672>number</span>&gt;&gt; <span style=color:#75715e>// A1 is number
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>A2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Unpack</span>&lt;<span style=color:#f92672>number</span>&gt; <span style=color:#75715e>// A2 is never
</span></span></span></code></pre></div></div><p>배열을 풀어내는 타입이라면 이렇게 정의할 수 있다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Flatten</span>&lt;<span style=color:#f92672>T</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>T</span> <span style=color:#66d9ef>extends</span> Array&lt;<span style=color:#f92672>infer</span> <span style=color:#a6e22e>Vals</span>&gt; <span style=color:#f92672>?</span> <span style=color:#a6e22e>Vals</span> : <span style=color:#66d9ef>never</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>A1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Flatten</span>&lt;<span style=color:#f92672>Customer</span><span style=color:#960050;background-color:#1e0010>[]</span>&gt; <span style=color:#75715e>// A1 is Customer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>A2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Flatten</span>&lt;<span style=color:#f92672>Customer</span>&gt; <span style=color:#75715e>// A2 is never
</span></span></span></code></pre></div></div><p>이런 응용 방식을 통해 제공되는 함수 인수의 타입을 추론하는 Parameters 내장 보조 타입이 있다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Parameters</span>&lt;<span style=color:#f92672>T</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>T</span> <span style=color:#66d9ef>extends</span> (...<span style=color:#a6e22e>args</span>: <span style=color:#66d9ef>infer</span> <span style=color:#a6e22e>Param</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>any</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>Param</span> : <span style=color:#66d9ef>never</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>A</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Parameters</span>&lt;<span style=color:#f92672>typeof</span> <span style=color:#a6e22e>createUser</span>&gt; <span style=color:#75715e>// A is [string, &#34;admin&#34; | &#34;maintenace&#34; | &#34;shipping&#34;, boolean]
</span></span></span></code></pre></div></div></div></div><div id=outline-container-headline-8 class=outline-3><h3 id=headline-8>Lesson 42</h3><div id=outline-text-headline-8 class=outline-text-3><pre class=example>
null 타입 다루기
</pre><p>tsconfig 에서 strictNullChecks 을 활성화하여 undefined 와 null 을 고유한 타입 속성으로 처리하게 할 수 있다. 이는 nullish 한 경우를 강력하게 제약하여 타입 안전을 도모한다.
이전 학습에서 살펴 본 fetchOrderList 함수를 다시 보자.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>declare</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fetchOrderList</span>(<span style=color:#a6e22e>input</span>: <span style=color:#66d9ef>Customer</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Product</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>Order</span><span style=color:#960050;background-color:#1e0010>[]</span>&gt;</span></span></code></pre></div></div><p>Promise 는 그 정의에도 있지만 rejected 될 수 있다. 그리고 return any 라면 null 과 undefined 그리고 never 를 포함하고 있다. 실제 추론되는 함수 선언 타입은 아래와 같다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>declare</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fetchOrderList</span>(<span style=color:#a6e22e>input</span>: <span style=color:#66d9ef>Customer</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Product</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>Order</span><span style=color:#960050;background-color:#1e0010>[]</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#a6e22e>null</span>&gt;</span></span></code></pre></div></div><p>이어 소개되는 NunNullable 타입을 위해 listOrder 함수 선언을 보자. fetchOrderList 의 반환 결과를 활용할 수 있도록 구성하면 이렇게 된다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>declare</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>listOrders</span>(<span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span></span></span></code></pre></div></div><p>만약 listOrder 안에서 null 처리가 되어 있다면 아래와 같이 선언하고 싶을 것이다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>declare</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>listOrders</span>(<span style=color:#a6e22e>Order</span>[])<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span></span></span></code></pre></div></div><p>이를 위해 아래의 제너릭으로 확장한 함수 선언을 보자</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>declare</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>isAvailable</span>&lt;<span style=color:#f92672>Obj</span>&gt;(<span style=color:#a6e22e>obj</span>: <span style=color:#66d9ef>Obj</span> )<span style=color:#f92672>:</span> <span style=color:#a6e22e>obj</span> <span style=color:#66d9ef>is</span> <span style=color:#a6e22e>NonNullable</span>&lt;<span style=color:#f92672>Obj</span>&gt;</span></span></code></pre></div></div><p>NonNullable 은 아래와 같이 구성할 수 있다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>NonNullable</span>&lt;<span style=color:#f92672>T</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>T</span> <span style=color:#66d9ef>extends</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>undefined</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>never</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>T</span></span></span></code></pre></div></div><p>이를 활용해 isAvailable 함수를 구현해 보자.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>isAvaialble</span>&lt;<span style=color:#f92672>Obj</span>&gt;(<span style=color:#a6e22e>obj</span>: <span style=color:#66d9ef>Obj</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>obj</span> <span style=color:#66d9ef>is</span> <span style=color:#a6e22e>NonNullable</span>&lt;<span style=color:#f92672>Obj</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>obj</span> <span style=color:#f92672>!==</span> <span style=color:#e6db74>&#39;undefined&#39;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>obj</span> <span style=color:#f92672>!==</span> <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>orders</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetchOrderList</span>(<span style=color:#a6e22e>customer</span>) <span style=color:#75715e>// orders is Order[] | null
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isAvailable</span>(<span style=color:#a6e22e>orders</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>listOrders</span>(<span style=color:#a6e22e>orders</span>) <span style=color:#75715e>//orders is Order[]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}</span></span></code></pre></div></div><p>이 점검은 런타임에서 일어나지 않고 타입스크립트의 컴파일 타임에 제약된다는 것이다. 데이터를 패치하여 주문 목록을 구하는 함수를 다시 설계 해 보자.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchDBKind</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;orders&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;products&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;customers&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchDBReturn</span>&lt;<span style=color:#f92672>T</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>T</span> <span style=color:#66d9ef>extends</span> <span style=color:#e6db74>&#39;orders&#39;</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>Order</span>[] <span style=color:#f92672>:</span> <span style=color:#a6e22e>T</span> <span style=color:#66d9ef>extends</span> <span style=color:#e6db74>&#39;products&#39;</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>Products</span>[] <span style=color:#f92672>:</span> <span style=color:#a6e22e>T</span> <span style=color:#66d9ef>extends</span> <span style=color:#e6db74>&#39;customers&#39;</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>Customers</span>[] <span style=color:#f92672>:</span> <span style=color:#66d9ef>never</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>declare</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fetchFromDatabase</span>&lt;<span style=color:#f92672>Kin</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>FetchKind</span>&gt;(<span style=color:#a6e22e>kind</span>: <span style=color:#66d9ef>Kin</span> )<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>FetchDbReturn</span>&lt;<span style=color:#f92672>Kin</span>&gt;<span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#a6e22e>null</span>&gt;</span></span></code></pre></div></div><p>이 타입을 활용하는 고차함수를 구성해 보자. 자바스크립트는 함수형 프로그래밍에도 잘 맞는다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>process</span>&lt;<span style=color:#f92672>T</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>any</span>&gt;&gt;(<span style=color:#a6e22e>promise</span>: <span style=color:#66d9ef>T</span>, <span style=color:#a6e22e>cb</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>res</span>: <span style=color:#66d9ef>Unpack</span>&lt;<span style=color:#f92672>NonNullable</span>&lt;<span style=color:#f92672>T</span>&gt;&gt;) <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>void</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>promise</span>.<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>res</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isAvailable</span>(<span style=color:#a6e22e>res</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>cb</span>(<span style=color:#a6e22e>res</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div><p>데이터가 잘 fetch 된 경우에 listOrder 를 실행한다.</p><div class="src src-typescript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#a6e22e>process</span>(<span style=color:#a6e22e>fetchFromDatabase</span>(<span style=color:#e6db74>&#39;orders&#39;</span>), <span style=color:#a6e22e>listOrders</span>)</span></span></code></pre></div></div><p>조건부 타입을 통해 복잡한 데이터 모델의 타입을 구성하고 제너릭하게 표현하고 보조 타입과 결합하여 안전한 자바스크립트 코딩을 하도록 강제한다.</p></div></div></div></div></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>